{"version":3,"file":"vue-tinymce.cjs.js","sources":["../src/vue-tinymce.vue","../src/main.js"],"sourcesContent":["<script>\r\n\r\n/**\r\n * 注：编辑器二次刷新处理\r\n * 编辑器二次刷新具体效果为输入光标重置到第一行第一个字前。\r\n * 这种效果根本无法正常录入，其原因是双向绑定数据导致编辑器数据更新所致。\r\n * 根据编辑器的不同状态做标记，当标记为`INPUT`录入时，数据将不会更新至编辑器，\r\n * 从而避免二次更新的情况，具体请看`content`部分和`editor event`部分的代码。\r\n * */\r\n\r\nconst INIT = 0;\r\nconst INPUT = 1;\r\nconst CHANGED = 2;\r\n\r\nconst status = ['INIT', 'INPUT', 'CHANGED']\r\nconst changedLog = debug=>{\r\n    if(!debug) return ()=>false\r\n    console.warn(\"`@packy-tang/vue-tinymce`进入debug模式\");\r\n    return (e, _status, val, oldVal)=>console.log(`来自：%s | 状态：%s \\n %s \\n %s`, e.type, status[_status], val, oldVal)\r\n}\r\n\r\nexport default {\r\n    name: \"VueTinymce\",\r\n    model: {\r\n        prop: \"content\",\r\n        event: \"change\"\r\n    },\r\n    props: {\r\n        content: {\r\n            type: [String, Object],\r\n            default: ''\r\n        },\r\n        setup: {\r\n            type: Function,\r\n            default: function(){}\r\n        },\r\n        disabled: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        setting: {\r\n            type: Object,\r\n            default: function(){ \r\n                return {};\r\n            }\r\n        },\r\n        debug: Boolean\r\n    },\r\n    render(createElement){\r\n        if(typeof tinymce === \"undefined\"){\r\n            return createElement('div', \"tinymce is undefined\"); \r\n        }\r\n        return createElement('div', {\r\n            attrs: {\r\n                id: this.id\r\n            }\r\n        });\r\n    },\r\n    data(){\r\n        return {\r\n            id: 'vue-tinymce-'+Date.now()+Math.floor(Math.random() * 1000),\r\n            editor: null,\r\n            status: INIT,\r\n            bookmark: null\r\n        }\r\n    },\r\n    watch: {\r\n        content(val, oldVal){\r\n            this.changedLog({ type: \"propsChanged\" }, this.status, `${val} | ${oldVal}`, \"--\")\r\n            if(this.status === INPUT || oldVal === val) return;\r\n            if(!this.editor || !this.editor.initialized) return; // fix editor plugin is loading and set content will throw error.\r\n            if(val === null) return this.resetContent(\"\");\r\n            this.setContent(val);\r\n        },\r\n        disabled(val){\r\n            this.editor.setMode(val?\"readonly\":\"design\")\r\n        }\r\n    },\r\n    created(){\r\n        this.changedLog = changedLog(this.debug)\r\n        if(typeof tinymce === \"undefined\") throw new Error('tinymce undefined');\r\n    },\r\n    beforeMount () {\r\n        const setting = Object.assign({},\r\n            this.setting,\r\n            {\r\n                selector: '#'+this.id,\r\n                setup: (editor)=> {\r\n                    this.setup(editor);\r\n                    // console.log('setup');\r\n                    editor.on('init', ()=>{\r\n                        // console.log('init', this.content);\r\n                        this.setContent(this.content, editor)\r\n                        editor.on('keyup input', e=>{ //只在编辑器中打字才会触发\r\n                            this.status = INPUT       //编辑器录入文字时标记为`INPUT`状态\r\n                        })\r\n                        editor.on('SetContent', e=>{ //编辑器在插入图片和撤销/重做时触发，组件content更新数据也会导致触发\r\n                            this.changedLog(e, this.status, editor.getContent(), \"--\")\r\n                        })\r\n                        editor.on('Blur', e=>{\r\n                            this.status = INIT\r\n                            this.changedLog(e, this.status, editor.getContent(), \"--\")\r\n                        })\r\n                        editor.on('input keyup Change Undo Redo ExecCommand NodeChange', e=>{\r\n                            this.onChanged(e, editor)\r\n                        })\r\n                    });\r\n                }\r\n            }\r\n        );\r\n        this.editor = tinymce.createEditor(setting.selector, setting)\r\n    },\r\n    mounted(){\r\n        this.editor.targetElm = this.$el\r\n        this.editor.render()\r\n    },\r\n    updated () {\r\n        this.editor.render()\r\n    },\r\n    beforeDestroy: function(){\r\n        this.editor.remove();\r\n    },\r\n    methods: {\r\n        setContent(val, editor){\r\n            if(!editor) editor = this.editor\r\n            editor.setContent(val)\r\n            editor.selection.moveToBookmark(this.bookmark)\r\n        },\r\n        resetContent(val, editor){\r\n            if(!editor) editor = this.editor\r\n            if(!!editor.resetContent) return editor.resetContent(val)\r\n            editor.setContent(val)\r\n            editor.setDirty(false)\r\n            editor.undoManager.clear()\r\n        },\r\n        onChanged(e, editor){\r\n            if(!editor) editor = this.editor\r\n            if(e.type === 'change') this.bookmark = e.level.bookmark\r\n            const content = editor.getContent()\r\n            this.changedLog(e, this.status, content, \"--\")\r\n            this.$emit('change', content);\r\n        }\r\n    }\r\n}\r\n</script>\r\n","import VueTinymce from './vue-tinymce.vue'\r\nexport { VueTinymce }\r\nclass VuePlugin{\r\n    constructor(){\r\n        const { prefix } = { prefix: \"\" }\r\n        this.prefix = prefix;\r\n    }\r\n    install(Vue, options={}){\r\n        const prefix = options.prefix || this.prefix\r\n        const components = {\r\n            VueTinymce\r\n        }\r\n        Object.keys(components).forEach(key => {\r\n            const component = components[key];\r\n            Vue.component(prefix+component.name, component);\r\n        });\r\n    }\r\n}\r\nexport default new VuePlugin()"],"names":["status","name","model","prop","event","props","content","type","String","Object","default","setup","Function","disabled","Boolean","setting","debug","[object Object]","createElement","tinymce","attrs","id","this","data","Date","now","Math","floor","random","editor","bookmark","watch","val","oldVal","changedLog","initialized","resetContent","setContent","setMode","console","warn","e","_status","log","Error","assign","selector","on","getContent","onChanged","createEditor","targetElm","$el","render","beforeDestroy","remove","methods","selection","moveToBookmark","setDirty","undoManager","clear","level","$emit","prefix","Vue","options","components","VueTinymce","keys","forEach","key","component"],"mappings":"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"}