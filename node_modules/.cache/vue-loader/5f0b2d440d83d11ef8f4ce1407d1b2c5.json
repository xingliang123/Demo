{"remainingRequest":"/Users/monkey/Downloads/vue-cli3 demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/monkey/Downloads/vue-cli3 demo/src/components/CanvasEdit/Index1.vue?vue&type=script&lang=ts","dependencies":[{"path":"/Users/monkey/Downloads/vue-cli3 demo/src/components/CanvasEdit/Index1.vue","mtime":1700451179448},{"path":"/Users/monkey/Downloads/vue-cli3 demo/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/Users/monkey/Downloads/vue-cli3 demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/monkey/Downloads/vue-cli3 demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLy8gaW1wb3J0IHsKLy8gICB3aW5kb3dPbmxvYWQsCi8vICAgY29udGFpbmVyRXhwb3J0LAovLyAgIHJlY292ZXJ5VGFibGVGdW4sCi8vICAgIGluc3RhbmNlRXhwb3J0Ci8vIH0gZnJvbSAiLi4vQ2FudmFzRWRpdC9tYWluIgppbXBvcnQgewogIG9wdGlvbnMKfSBmcm9tICcuL21vY2snCmludGVyZmFjZSBJQ29tbWVudCB7CiAgaWQ6IHN0cmluZwogIGNvbnRlbnQ6IHN0cmluZwogIHVzZXJOYW1lOiBzdHJpbmcKICByYW5nZVRleHQ6IHN0cmluZwogIGNyZWF0ZWREYXRlOiBzdHJpbmcKfQpsZXQgY29tbWVudExpc3Q6IElDb21tZW50W10KY29uc3QgZWxlbWVudExpc3Q6IElFbGVtZW50W10gPSBbXQpleHBvcnQgY29uc3QgZGF0YTogSUVsZW1lbnRbXSA9IGVsZW1lbnRMaXN0CmltcG9ydCAnLi9zdHlsZS5jc3MnCmltcG9ydCBwcmlzbSBmcm9tICdwcmlzbWpzJwppbXBvcnQgRWRpdG9yLCB7CiAgQmxvY2tUeXBlLAogIENvbW1hbmQsCiAgQ29udHJvbFR5cGUsCiAgRWRpdG9yTW9kZSwKICBFZGl0b3Jab25lLAogIEVsZW1lbnRUeXBlLAogIElCbG9jaywKICBJQ2F0YWxvZ0l0ZW0sCiAgSUVsZW1lbnQsCiAgS2V5TWFwLAogIExpc3RTdHlsZSwKICBMaXN0VHlwZSwKICBQYWdlTW9kZSwKICBQYXBlckRpcmVjdGlvbiwKICBSb3dGbGV4LAogIFRpdGxlTGV2ZWwKfSBmcm9tICcuL2VkaXRvcicKaW1wb3J0IHsKICBEaWFsb2cKfSBmcm9tICcuL2NvbXBvbmVudHMvZGlhbG9nL0RpYWxvZycKaW1wb3J0IHsKICBmb3JtYXRQcmlzbVRva2VuCn0gZnJvbSAnLi91dGlscy9wcmlzbScKaW1wb3J0IHsKICBTaWduYXR1cmUKfSBmcm9tICcuL2NvbXBvbmVudHMvc2lnbmF0dXJlL1NpZ25hdHVyZScKaW1wb3J0IHsKICBkZWJvdW5jZSwKICBuZXh0VGljaywKICBzY3JvbGxJbnRvVmlldwp9IGZyb20gJy4vdXRpbHMnCmltcG9ydCB7CiAgZm9ybWF0RWxlbWVudExpc3QKfSBmcm9tICcuL2VkaXRvci91dGlscy9lbGVtZW50JwpsZXQgaW5zdGFuY2VFeHBvcnQ6IGFueTsKbGV0IG9iaiA9IHt9OwppbXBvcnQgVnVlIGZyb20gJ3Z1ZSc7CmV4cG9ydCBkZWZhdWx0IFZ1ZS5leHRlbmQoewogIGNvbXBvbmVudHM6IHt9LAogIHByb3BzOiBbJ2VkaXRJZCcsICdjb250ZW50J10sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGFhOiAnJwogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIGNvbnN0IGlzQXBwbGUgPQogICAgICB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiAvTWFjIE9TIFgvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkKCiAgICAvLyAxLiDliJ3lp4vljJbnvJbovpHlmagKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLmNhbnZhcycgKyB0aGlzLmVkaXRJZCkgIQoKICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgRWRpdG9yKAogICAgICAgIGNvbnRhaW5lciwgewogICAgICAgICAgaGVhZGVyOiBbXSwKICAgICAgICAgIG1haW46IDwgSUVsZW1lbnRbXSA+IGRhdGEsCiAgICAgICAgICBmb290ZXI6IFtdCiAgICAgICAgfSwKICAgICAgICBvcHRpb25zCiAgICAgICkKICAgIHRoaXMuJGVtaXQoInNhdmVJbnN0YW5jZSIsIGluc3RhbmNlKQogICAgb2JqID0gewogICAgICBiZ0lkOiB0aGlzLmVkaXRJZCwKICAgICAgaW5zdGFuY2U6IGluc3RhbmNlCiAgICB9CiAgICBpbnN0YW5jZUV4cG9ydCA9IGluc3RhbmNlCiAgICBjb25zb2xlLmxvZygn5a6e5L6LOiAnLCBpbnN0YW5jZSkKICAgIC8vIGN5cHJlc3Pkvb/nlKgKICAgIFJlZmxlY3Quc2V0KHdpbmRvdywgJ2VkaXRvcicsIGluc3RhbmNlKQoKICAgIC8vIOiPnOWNleW8ueeql+mUgOavgQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICdjbGljaycsCiAgICAgIGV2dCA9PiB7CiAgICAgICAgY29uc3QgdmlzaWJsZURvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aXNpYmxlJykKICAgICAgICBpZiAoIXZpc2libGVEb20gfHwgdmlzaWJsZURvbS5jb250YWlucyggPCBOb2RlID4gZXZ0LnRhcmdldCkpIHJldHVybgogICAgICAgIHZpc2libGVEb20uY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpCiAgICAgIH0sIHsKICAgICAgICBjYXB0dXJlOiB0cnVlCiAgICAgIH0KICAgICkKCiAgICAvLyAyLiB8IOaSpOmUgCB8IOmHjeWBmiB8IOagvOW8j+WItyB8IOa4hemZpOagvOW8jyB8CiAgICBjb25zdCB1bmRvRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX191bmRvJykgIQogICAgICB1bmRvRG9tLnRpdGxlID0gYOaSpOmUgCgke2lzQXBwbGUgPyAn4oyYJyA6ICdDdHJsJ30rWilgCiAgICB1bmRvRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCd1bmRvJykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlVW5kbygpCiAgICB9CgogICAgY29uc3QgcmVkb0RvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fcmVkbycpICEKICAgICAgcmVkb0RvbS50aXRsZSA9IGDph43lgZooJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K1kpYAogICAgcmVkb0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygncmVkbycpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVJlZG8oKQogICAgfQoKICAgIGNvbnN0IHBhaW50ZXJEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3BhaW50ZXInCiAgICAgICkgIQogICAgICBwYWludGVyRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ3BhaW50ZXInKQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVBhaW50ZXIoewogICAgICAgICAgaXNEYmxjbGljazogZmFsc2UKICAgICAgICB9KQogICAgICB9CiAgICBwYWludGVyRG9tLm9uZGJsY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdwYWludGVyJykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlUGFpbnRlcih7CiAgICAgICAgaXNEYmxjbGljazogdHJ1ZQogICAgICB9KQogICAgfQoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fZm9ybWF0JykgIS5vbmNsaWNrID0KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdmb3JtYXQnKQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUZvcm1hdCgpCiAgICAgIH0KCiAgICAvLyAzLiB8IOWtl+S9kyB8IOWtl+S9k+WPmOWkpyB8IOWtl+S9k+WPmOWwjyB8IOWKoOeylyB8IOaWnOS9kyB8IOS4i+WIkue6vyB8IOWIoOmZpOe6vyB8IOS4iuaghyB8IOS4i+aghyB8IOWtl+S9k+minOiJsiB8IOiDjOaZr+iJsiB8CiAgICBjb25zdCBmb250RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19mb250JykgIQogICAgICBjb25zdCBmb250U2VsZWN0RG9tID0gZm9udERvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5zZWxlY3QnKSAhCiAgICAgICAgY29uc3QgZm9udE9wdGlvbkRvbSA9IGZvbnREb20ucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcub3B0aW9ucycpICEKICAgICAgICAgIGZvbnREb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZvbnQnKQogICAgICAgICAgICBmb250T3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICAgICAgfQogICAgZm9udE9wdGlvbkRvbS5vbmNsaWNrID0gZnVuY3Rpb24gKGV2dCkgewogICAgICBjb25zdCBsaSA9IGV2dC50YXJnZXQgYXMgSFRNTExJRWxlbWVudAogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVGb250KGxpLmRhdGFzZXQuZmFtaWx5ISkKICAgIH0KCiAgICBjb25zdCBzaXplU2V0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19zaXplJykgIQogICAgICBjb25zdCBzaXplU2VsZWN0RG9tID0gc2l6ZVNldERvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5zZWxlY3QnKSAhCiAgICAgICAgY29uc3Qgc2l6ZU9wdGlvbkRvbSA9IHNpemVTZXREb20ucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcub3B0aW9ucycpICEKICAgICAgICAgIHNpemVTZXREb20udGl0bGUgPSBg6K6+572u5a2X5Y+3YAogICAgc2l6ZVNldERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnc2l6ZScpCiAgICAgIHNpemVPcHRpb25Eb20uY2xhc3NMaXN0LnRvZ2dsZSgndmlzaWJsZScpCiAgICB9CiAgICBzaXplT3B0aW9uRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGNvbnN0IGxpID0gZXZ0LnRhcmdldCBhcyBIVE1MTElFbGVtZW50CiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVNpemUoTnVtYmVyKGxpLmRhdGFzZXQuc2l6ZSEpKQogICAgfQoKICAgIGNvbnN0IHNpemVBZGREb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3NpemUtYWRkJwogICAgICApICEKICAgICAgc2l6ZUFkZERvbS50aXRsZSA9IGDlop7lpKflrZflj7coJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K1spYAogICAgc2l6ZUFkZERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnc2l6ZS1hZGQnKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTaXplQWRkKCkKICAgIH0KCiAgICBjb25zdCBzaXplTWludXNEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3NpemUtbWludXMnCiAgICAgICkgIQogICAgICBzaXplTWludXNEb20udGl0bGUgPSBg5YeP5bCP5a2X5Y+3KCR7aXNBcHBsZSA/ICfijJgnIDogJ0N0cmwnfStdKWAKICAgIHNpemVNaW51c0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnc2l6ZS1taW51cycpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVNpemVNaW51cygpCiAgICB9CgogICAgY29uc3QgYm9sZERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fYm9sZCcpICEKICAgICAgYm9sZERvbS50aXRsZSA9IGDliqDnspcoJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K0IpYAogICAgYm9sZERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnYm9sZCcpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUJvbGQoKQogICAgfQoKICAgIGNvbnN0IGl0YWxpY0RvbSA9CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9faXRhbGljJykgIQogICAgICBpdGFsaWNEb20udGl0bGUgPSBg5pac5L2TKCR7aXNBcHBsZSA/ICfijJgnIDogJ0N0cmwnfStJKWAKICAgIGl0YWxpY0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnaXRhbGljJykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSXRhbGljKCkKICAgIH0KCiAgICBjb25zdCB1bmRlcmxpbmVEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3VuZGVybGluZScKICAgICAgKSAhCiAgICAgIHVuZGVybGluZURvbS50aXRsZSA9IGDkuIvliJLnur8oJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K1UpYAogICAgdW5kZXJsaW5lRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCd1bmRlcmxpbmUnKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVVbmRlcmxpbmUoKQogICAgfQoKICAgIGNvbnN0IHN0cmlrZW91dERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAnLm1lbnUtaXRlbV9fc3RyaWtlb3V0JwogICAgICApICEKICAgICAgc3RyaWtlb3V0RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ3N0cmlrZW91dCcpCiAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlU3RyaWtlb3V0KCkKICAgICAgfQoKICAgIGNvbnN0IHN1cGVyc2NyaXB0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKAogICAgICAgICcubWVudS1pdGVtX19zdXBlcnNjcmlwdCcKICAgICAgKSAhCiAgICAgIHN1cGVyc2NyaXB0RG9tLnRpdGxlID0gYOS4iuaghygke2lzQXBwbGUgPyAn4oyYJyA6ICdDdHJsJ30rU2hpZnQrLClgCiAgICBzdXBlcnNjcmlwdERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnc3VwZXJzY3JpcHQnKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTdXBlcnNjcmlwdCgpCiAgICB9CgogICAgY29uc3Qgc3Vic2NyaXB0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKAogICAgICAgICcubWVudS1pdGVtX19zdWJzY3JpcHQnCiAgICAgICkgIQogICAgICBzdWJzY3JpcHREb20udGl0bGUgPSBg5LiL5qCHKCR7aXNBcHBsZSA/ICfijJgnIDogJ0N0cmwnfStTaGlmdCsuKWAKICAgIHN1YnNjcmlwdERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICBjb25zb2xlLmxvZygnc3Vic2NyaXB0JykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlU3Vic2NyaXB0KCkKICAgIH0KCiAgICBjb25zdCBjb2xvckNvbnRyb2xEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTElucHV0RWxlbWVudCA+ICgnI2NvbG9yJykgIQogICAgICBjb2xvckNvbnRyb2xEb20ub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVDb2xvcihjb2xvckNvbnRyb2xEb20udmFsdWUpCiAgICAgIH0KICAgIGNvbnN0IGNvbG9yRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19jb2xvcicpICEKICAgICAgY29uc3QgY29sb3JTcGFuRG9tID0gY29sb3JEb20ucXVlcnlTZWxlY3Rvcignc3BhbicpICEKICAgICAgICBjb2xvckRvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ2NvbG9yJykKICAgICAgICAgIGNvbG9yQ29udHJvbERvbS5jbGljaygpCiAgICAgICAgfQoKICAgIGNvbnN0IGhpZ2hsaWdodENvbnRyb2xEb20gPQogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTElucHV0RWxlbWVudCA+ICgnI2hpZ2hsaWdodCcpICEKICAgICAgaGlnaGxpZ2h0Q29udHJvbERvbS5vbmlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUhpZ2hsaWdodChoaWdobGlnaHRDb250cm9sRG9tLnZhbHVlKQogICAgICB9CiAgICBjb25zdCBoaWdobGlnaHREb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX2hpZ2hsaWdodCcKICAgICAgKSAhCiAgICAgIGNvbnN0IGhpZ2hsaWdodFNwYW5Eb20gPSBoaWdobGlnaHREb20ucXVlcnlTZWxlY3Rvcignc3BhbicpICEKICAgICAgICBoaWdobGlnaHREb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdoaWdobGlnaHQnKQogICAgICAgICAgaGlnaGxpZ2h0Q29udHJvbERvbS5jbGljaygpCiAgICAgICAgfQoKICAgIGNvbnN0IHRpdGxlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX190aXRsZScpICEKICAgICAgY29uc3QgdGl0bGVTZWxlY3REb20gPSB0aXRsZURvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5zZWxlY3QnKSAhCiAgICAgICAgY29uc3QgdGl0bGVPcHRpb25Eb20gPSB0aXRsZURvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5vcHRpb25zJykgIQogICAgICAgICAgdGl0bGVPcHRpb25Eb20ucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKChsaSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgbGkudGl0bGUgPSBgQ3RybCske2lzQXBwbGUgPyAnT3B0aW9uJyA6ICdBbHQnfSske2luZGV4fWAKICAgICAgICAgIH0pCgogICAgdGl0bGVEb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc29sZS5sb2coJ3RpdGxlJykKICAgICAgdGl0bGVPcHRpb25Eb20uY2xhc3NMaXN0LnRvZ2dsZSgndmlzaWJsZScpCiAgICB9CiAgICB0aXRsZU9wdGlvbkRvbS5vbmNsaWNrID0gZnVuY3Rpb24gKGV2dCkgewogICAgICBjb25zdCBsaSA9IGV2dC50YXJnZXQgYXMgSFRNTExJRWxlbWVudAogICAgICBjb25zdCBsZXZlbCA9IDwgVGl0bGVMZXZlbCA+IGxpLmRhdGFzZXQubGV2ZWwKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlVGl0bGUobGV2ZWwgfHwgbnVsbCkKICAgIH0KCiAgICBjb25zdCBsZWZ0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19sZWZ0JykgIQogICAgICBsZWZ0RG9tLnRpdGxlID0gYOW3puWvuem9kCgke2lzQXBwbGUgPyAn4oyYJyA6ICdDdHJsJ30rTClgCiAgICBsZWZ0RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdsZWZ0JykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlUm93RmxleChSb3dGbGV4LkxFRlQpCiAgICB9CgogICAgY29uc3QgY2VudGVyRG9tID0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19jZW50ZXInKSAhCiAgICAgIGNlbnRlckRvbS50aXRsZSA9IGDlsYXkuK3lr7npvZAoJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K0UpYAogICAgY2VudGVyRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdjZW50ZXInKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVSb3dGbGV4KFJvd0ZsZXguQ0VOVEVSKQogICAgfQoKICAgIGNvbnN0IHJpZ2h0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19yaWdodCcpICEKICAgICAgcmlnaHREb20udGl0bGUgPSBg5Y+z5a+56b2QKCR7aXNBcHBsZSA/ICfijJgnIDogJ0N0cmwnfStSKWAKICAgIHJpZ2h0RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdyaWdodCcpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVJvd0ZsZXgoUm93RmxleC5SSUdIVCkKICAgIH0KCiAgICBjb25zdCBhbGlnbm1lbnREb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX2FsaWdubWVudCcKICAgICAgKSAhCiAgICAgIGFsaWdubWVudERvbS50aXRsZSA9IGDkuKTnq6/lr7npvZAoJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K0opYAogICAgYWxpZ25tZW50RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdhbGlnbm1lbnQnKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVSb3dGbGV4KFJvd0ZsZXguQUxJR05NRU5UKQogICAgfQoKICAgIGNvbnN0IHJvd01hcmdpbkRvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAnLm1lbnUtaXRlbV9fcm93LW1hcmdpbicKICAgICAgKSAhCiAgICAgIGNvbnN0IHJvd09wdGlvbkRvbSA9IHJvd01hcmdpbkRvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5vcHRpb25zJykgIQogICAgICAgIHJvd01hcmdpbkRvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ3Jvdy1tYXJnaW4nKQogICAgICAgICAgcm93T3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICAgIH0KICAgIHJvd09wdGlvbkRvbS5vbmNsaWNrID0gZnVuY3Rpb24gKGV2dCkgewogICAgICBjb25zdCBsaSA9IGV2dC50YXJnZXQgYXMgSFRNTExJRWxlbWVudAogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVSb3dNYXJnaW4oTnVtYmVyKGxpLmRhdGFzZXQucm93bWFyZ2luISkpCiAgICB9CgogICAgY29uc3QgbGlzdERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fbGlzdCcpICEKICAgICAgbGlzdERvbS50aXRsZSA9IGDliJfooagoJHtpc0FwcGxlID8gJ+KMmCcgOiAnQ3RybCd9K1NoaWZ0K1UpYAogICAgY29uc3QgbGlzdE9wdGlvbkRvbSA9IGxpc3REb20ucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcub3B0aW9ucycpICEKICAgICAgbGlzdERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdsaXN0JykKICAgICAgICBsaXN0T3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICB9CiAgICBsaXN0T3B0aW9uRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGNvbnN0IGxpID0gZXZ0LnRhcmdldCBhcyBIVE1MTElFbGVtZW50CiAgICAgIGNvbnN0IGxpc3RUeXBlID0gPCBMaXN0VHlwZSA+IGxpLmRhdGFzZXQubGlzdFR5cGUgfHwgbnVsbAogICAgICBjb25zdCBsaXN0U3R5bGUgPSA8IExpc3RTdHlsZSA+ICggPCB1bmtub3duID4gbGkuZGF0YXNldC5saXN0U3R5bGUpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUxpc3QobGlzdFR5cGUsIGxpc3RTdHlsZSkKICAgIH0KCiAgICAvLyA0LiB8IOihqOagvCB8IOWbvueJhyB8IOi2hemTvuaOpSB8IOWIhuWJsue6vyB8IOawtOWNsCB8IOS7o+eggeWdlyB8IOWIhumalOespiB8IOaOp+S7tiB8IOWkjemAieahhiB8IExhVGVYIHwg5pel5pyf6YCJ5oup5ZmoCiAgICBjb25zdCB0YWJsZURvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fdGFibGUnKSAhCiAgICAgIGNvbnN0IHRhYmxlUGFuZWxDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgICAnLm1lbnUtaXRlbV9fdGFibGVfX2NvbGxhcHNlJwogICAgICAgICkgIQogICAgICAgIGNvbnN0IHRhYmxlQ2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy50YWJsZS1jbG9zZScpICEKICAgICAgICAgIGNvbnN0IHRhYmxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy50YWJsZS1zZWxlY3QnKSAhCiAgICAgICAgICAgIGNvbnN0IHRhYmxlUGFuZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy50YWJsZS1wYW5lbCcpICEKICAgICAgICAgICAgICAvLyDnu5jliLbooYzliJcKCiAgICAgICAgICAgICAgY29uc3QgdGFibGVDZWxsTGlzdDogSFRNTERpdkVsZW1lbnRbXVtdID0gW10KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJykKICAgICAgdHIuY2xhc3NMaXN0LmFkZCgndGFibGUtcm93JykKICAgICAgY29uc3QgdHJDZWxsTGlzdDogSFRNTERpdkVsZW1lbnRbXSA9IFtdCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykgewogICAgICAgIGNvbnN0IHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKQogICAgICAgIHRkLmNsYXNzTGlzdC5hZGQoJ3RhYmxlLWNlbCcpCiAgICAgICAgdHIuYXBwZW5kKHRkKQogICAgICAgIHRyQ2VsbExpc3QucHVzaCh0ZCkKICAgICAgfQogICAgICB0YWJsZVBhbmVsLmFwcGVuZCh0cikKICAgICAgdGFibGVDZWxsTGlzdC5wdXNoKHRyQ2VsbExpc3QpCiAgICB9CgogICAgbGV0IGNvbEluZGV4ID0gMAogICAgbGV0IHJvd0luZGV4ID0gMAogICAgLy8g56e76Zmk5omA5pyJ5qC86YCJ5oupCiAgICBmdW5jdGlvbiByZW1vdmVBbGxUYWJsZUNlbGxTZWxlY3QoKSB7CiAgICAgIHRhYmxlQ2VsbExpc3QuZm9yRWFjaCh0ciA9PiB7CiAgICAgICAgdHIuZm9yRWFjaCh0ZCA9PiB0ZC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgfSkKICAgIH0KICAgIC8vIOiuvue9ruagh+mimOWGheWuuQogICAgZnVuY3Rpb24gc2V0VGFibGVUaXRsZShwYXlsb2FkOiBzdHJpbmcpIHsKICAgICAgdGFibGVUaXRsZS5pbm5lclRleHQgPSBwYXlsb2FkCiAgICB9CiAgICAvLyDmgaLlpI3liJ3lp4vnirbmgIEKICAgIGZ1bmN0aW9uIHJlY292ZXJ5VGFibGUoKSB7CiAgICAgIC8vIOi/mOWOn+mAieaLqeagt+W8j+OAgeagh+mimOOAgemAieaLqeihjOWIlwogICAgICByZW1vdmVBbGxUYWJsZUNlbGxTZWxlY3QoKQogICAgICBzZXRUYWJsZVRpdGxlKCfmj5LlhaUnKQogICAgICBjb2xJbmRleCA9IDAKICAgICAgcm93SW5kZXggPSAwCiAgICAgIC8vIOmakOiXj3BhbmVsCiAgICAgIHRhYmxlUGFuZWxDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgfQogICAgdGFibGVEb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc29sZS5sb2coJ3RhYmxlJykKICAgICAgdGFibGVQYW5lbENvbnRhaW5lciEuc3R5bGUuZGlzcGxheSA9ICdibG9jaycKICAgIH0KICAgIHRhYmxlUGFuZWwub25tb3VzZW1vdmUgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGNvbnN0IGNlbFNpemUgPSAxNgogICAgICBjb25zdCByb3dNYXJnaW5Ub3AgPSAxMAogICAgICBjb25zdCBjZWxNYXJnaW5SaWdodCA9IDYKICAgICAgY29uc3QgewogICAgICAgIG9mZnNldFgsCiAgICAgICAgb2Zmc2V0WQogICAgICB9ID0gZXZ0CiAgICAgIC8vIOenu+mZpOaJgOaciemAieaLqQogICAgICByZW1vdmVBbGxUYWJsZUNlbGxTZWxlY3QoKQogICAgICBjb2xJbmRleCA9IE1hdGguY2VpbChvZmZzZXRYIC8gKGNlbFNpemUgKyBjZWxNYXJnaW5SaWdodCkpIHx8IDEKICAgICAgcm93SW5kZXggPSBNYXRoLmNlaWwob2Zmc2V0WSAvIChjZWxTaXplICsgcm93TWFyZ2luVG9wKSkgfHwgMQogICAgICAvLyDmlLnlj5jpgInmi6nmoLflvI8KICAgICAgdGFibGVDZWxsTGlzdC5mb3JFYWNoKCh0ciwgdHJJbmRleCkgPT4gewogICAgICAgIHRyLmZvckVhY2goKHRkLCB0ZEluZGV4KSA9PiB7CiAgICAgICAgICBpZiAodGRJbmRleCA8IGNvbEluZGV4ICYmIHRySW5kZXggPCByb3dJbmRleCkgewogICAgICAgICAgICB0ZC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pCiAgICAgIC8vIOaUueWPmOihqOagvOagh+mimAogICAgICBzZXRUYWJsZVRpdGxlKGAke3Jvd0luZGV4fcOXJHtjb2xJbmRleH1gKQogICAgfQogICAgdGFibGVDbG9zZS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICByZWNvdmVyeVRhYmxlKCkKICAgIH0KICAgIHRhYmxlUGFuZWwub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgLy8g5bqU55So6YCJ5oupCiAgICAgIGNvbnNvbGUubG9nKCJzZHMiKQogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVJbnNlcnRUYWJsZShyb3dJbmRleCwgY29sSW5kZXgsIFtdLCAnJywgJycpCiAgICAgIHJlY292ZXJ5VGFibGUoKQogICAgfQoKICAgIGNvbnN0IGltYWdlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19pbWFnZScpICEKICAgICAgY29uc3QgaW1hZ2VGaWxlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxJbnB1dEVsZW1lbnQgPiAoJyNpbWFnZScpICEKICAgICAgICBpbWFnZURvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaW1hZ2VGaWxlRG9tLmNsaWNrKCkKICAgICAgICB9CiAgICBpbWFnZUZpbGVEb20ub25jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnN0IGZpbGUgPSBpbWFnZUZpbGVEb20uZmlsZXMhWzBdICEKICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKQogICAgICBmaWxlUmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8g6K6h566X5a696auYCiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKQogICAgICAgIGNvbnN0IHZhbHVlID0gZmlsZVJlYWRlci5yZXN1bHQgYXMgc3RyaW5nCiAgICAgICAgaW1hZ2Uuc3JjID0gdmFsdWUKICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVJbWFnZSh7CiAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICB3aWR0aDogaW1hZ2Uud2lkdGgsCiAgICAgICAgICAgIGhlaWdodDogaW1hZ2UuaGVpZ2h0CiAgICAgICAgICB9KQogICAgICAgICAgaW1hZ2VGaWxlRG9tLnZhbHVlID0gJycKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBoeXBlcmxpbmtEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX2h5cGVybGluaycKICAgICAgKSAhCiAgICAgIGh5cGVybGlua0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdoeXBlcmxpbmsnKQogICAgICAgIG5ldyBEaWFsb2coewogICAgICAgICAgdGl0bGU6ICfotoXpk77mjqUnLAogICAgICAgICAgZGF0YTogW3sKICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgbGFiZWw6ICfmlofmnKwnLAogICAgICAgICAgICAgIG5hbWU6ICduYW1lJywKICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeaWh+acrCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICBsYWJlbDogJ+mTvuaOpScsCiAgICAgICAgICAgICAgbmFtZTogJ3VybCcsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXpk77mjqUnCiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICBvbkNvbmZpcm06IHBheWxvYWQgPT4gewogICAgICAgICAgICBsZXQgbmFtZTEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICduYW1lJykKICAgICAgICAgICAgY29uc3QgbmFtZSA9ICEhbmFtZTEgPyBuYW1lMS52YWx1ZSA6IG51bGwKICAgICAgICAgICAgaWYgKCFuYW1lKSByZXR1cm4KICAgICAgICAgICAgbGV0IHVybDEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd1cmwnKQogICAgICAgICAgICBjb25zdCB1cmwgPSAhIXVybDEgPyB1cmwxLnZhbHVlIDogbnVsbAogICAgICAgICAgICBpZiAoIXVybCkgcmV0dXJuCiAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUh5cGVybGluayh7CiAgICAgICAgICAgICAgdHlwZTogRWxlbWVudFR5cGUuSFlQRVJMSU5LLAogICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgdmFsdWVMaXN0OiBuYW1lLnNwbGl0KCcnKS5tYXAobiA9PiAoewogICAgICAgICAgICAgICAgdmFsdWU6IG4sCiAgICAgICAgICAgICAgICBzaXplOiAxNgogICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0KCiAgICBjb25zdCBzZXBhcmF0b3JEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3NlcGFyYXRvcicKICAgICAgKSAhCiAgICAgIGNvbnN0IHNlcGFyYXRvck9wdGlvbkRvbSA9CiAgICAgICAgc2VwYXJhdG9yRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgc2VwYXJhdG9yRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnc2VwYXJhdG9yJykKICAgICAgICAgIHNlcGFyYXRvck9wdGlvbkRvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgICB9CiAgICBzZXBhcmF0b3JPcHRpb25Eb20ub25tb3VzZWRvd24gPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGxldCBwYXlsb2FkOiBudW1iZXJbXSA9IFtdCiAgICAgIGNvbnN0IGxpID0gZXZ0LnRhcmdldCBhcyBIVE1MTElFbGVtZW50CiAgICAgIGNvbnN0IHNlcGFyYXRvckRhc2ggPSBsaS5kYXRhc2V0LnNlcGFyYXRvciA/IGxpLmRhdGFzZXQuc2VwYXJhdG9yLnNwbGl0KCcsJykubWFwKE51bWJlcikgOiBudWxsCiAgICAgIGlmIChzZXBhcmF0b3JEYXNoKSB7CiAgICAgICAgY29uc3QgaXNTaW5nbGVMaW5lID0gc2VwYXJhdG9yRGFzaC5ldmVyeShkID0+IGQgPT09IDApCiAgICAgICAgaWYgKCFpc1NpbmdsZUxpbmUpIHsKICAgICAgICAgIHBheWxvYWQgPSBzZXBhcmF0b3JEYXNoCiAgICAgICAgfQogICAgICB9CiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVNlcGFyYXRvcihwYXlsb2FkKQogICAgfQoKICAgIGNvbnN0IHBhZ2VCcmVha0RvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAnLm1lbnUtaXRlbV9fcGFnZS1icmVhaycKICAgICAgKSAhCiAgICAgIHBhZ2VCcmVha0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdwYWdlQnJlYWsnKQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVBhZ2VCcmVhaygpCiAgICAgIH0KCiAgICBjb25zdCB3YXRlcm1hcmtEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX3dhdGVybWFyaycKICAgICAgKSAhCiAgICAgIGNvbnN0IHdhdGVybWFya09wdGlvbkRvbSA9CiAgICAgICAgd2F0ZXJtYXJrRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgd2F0ZXJtYXJrRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnd2F0ZXJtYXJrJykKICAgICAgICAgIHdhdGVybWFya09wdGlvbkRvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgICB9CiAgICB3YXRlcm1hcmtPcHRpb25Eb20ub25tb3VzZWRvd24gPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgIGNvbnN0IGxpID0gZXZ0LnRhcmdldCBhcyBIVE1MTElFbGVtZW50CiAgICAgIGNvbnN0IG1lbnUgPSBsaS5kYXRhc2V0Lm1lbnUhCiAgICAgICAgd2F0ZXJtYXJrT3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICBpZiAobWVudSA9PT0gJ2FkZCcpIHsKICAgICAgICBuZXcgRGlhbG9nKHsKICAgICAgICAgIHRpdGxlOiAn5rC05Y2wJywKICAgICAgICAgIGRhdGE6IFt7CiAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgIGxhYmVsOiAn5YaF5a65JywKICAgICAgICAgICAgICBuYW1lOiAnZGF0YScsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXlhoXlrrknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0eXBlOiAnY29sb3InLAogICAgICAgICAgICAgIGxhYmVsOiAn6aKc6ImyJywKICAgICAgICAgICAgICBuYW1lOiAnY29sb3InLAogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIHZhbHVlOiAnI0FFQjVDMCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHR5cGU6ICdudW1iZXInLAogICAgICAgICAgICAgIGxhYmVsOiAn5a2X5L2T5aSn5bCPJywKICAgICAgICAgICAgICBuYW1lOiAnc2l6ZScsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgdmFsdWU6ICcxMjAnCiAgICAgICAgICAgIH0KICAgICAgICAgIF0sCiAgICAgICAgICBvbkNvbmZpcm06IHBheWxvYWQgPT4gewogICAgICAgICAgICBjb25zdCBudWxsYWJsZUluZGV4ID0gcGF5bG9hZC5maW5kSW5kZXgocCA9PiAhcC52YWx1ZSkKICAgICAgICAgICAgaWYgKH5udWxsYWJsZUluZGV4KSByZXR1cm4KICAgICAgICAgICAgY29uc3Qgd2F0ZXJtYXJrID0gcGF5bG9hZC5yZWR1Y2UoKHByZSwgY3VyKSA9PiB7CiAgICAgICAgICAgICAgcHJlW2N1ci5uYW1lXSA9IGN1ci52YWx1ZQogICAgICAgICAgICAgIHJldHVybiBwcmUKICAgICAgICAgICAgfSwgPCBhbnkgPiB7fSkKICAgICAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlQWRkV2F0ZXJtYXJrKHsKICAgICAgICAgICAgICBkYXRhOiB3YXRlcm1hcmsuZGF0YSwKICAgICAgICAgICAgICBjb2xvcjogd2F0ZXJtYXJrLmNvbG9yLAogICAgICAgICAgICAgIHNpemU6IE51bWJlcih3YXRlcm1hcmsuc2l6ZSkKICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9IGVsc2UgewogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZURlbGV0ZVdhdGVybWFyaygpCiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBjb2RlYmxvY2tEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoCiAgICAgICAgJy5tZW51LWl0ZW1fX2NvZGVibG9jaycKICAgICAgKSAhCiAgICAgIGNvZGVibG9ja0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdjb2RlYmxvY2snKQogICAgICAgIG5ldyBEaWFsb2coewogICAgICAgICAgdGl0bGU6ICfku6PnoIHlnZcnLAogICAgICAgICAgZGF0YTogW3sKICAgICAgICAgICAgdHlwZTogJ3RleHRhcmVhJywKICAgICAgICAgICAgbmFtZTogJ2NvZGVibG9jaycsCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5Luj56CBJywKICAgICAgICAgICAgd2lkdGg6IDUwMCwKICAgICAgICAgICAgaGVpZ2h0OiAzMDAKICAgICAgICAgIH1dLAogICAgICAgICAgb25Db25maXJtOiBwYXlsb2FkID0+IHsKICAgICAgICAgICAgbGV0IGNvZGVibG9jazEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICdjb2RlYmxvY2snKQogICAgICAgICAgICBjb25zdCBjb2RlYmxvY2sgPSAhIWNvZGVibG9jazEgPyBjb2RlYmxvY2sxLnZhbHVlIDogbnVsbAogICAgICAgICAgICBpZiAoIWNvZGVibG9jaykgcmV0dXJuCiAgICAgICAgICAgIGNvbnN0IHRva2VuTGlzdCA9IHByaXNtLnRva2VuaXplKGNvZGVibG9jaywgcHJpc20ubGFuZ3VhZ2VzLmphdmFzY3JpcHQpCiAgICAgICAgICAgIGNvbnN0IGZvcm1hdFRva2VuTGlzdCA9IGZvcm1hdFByaXNtVG9rZW4odG9rZW5MaXN0KQogICAgICAgICAgICBjb25zdCBlbGVtZW50TGlzdDogSUVsZW1lbnRbXSA9IFtdCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZm9ybWF0VG9rZW5MaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgY29uc3QgZm9ybWF0VG9rZW4gPSBmb3JtYXRUb2tlbkxpc3RbaV0KICAgICAgICAgICAgICBjb25zdCB0b2tlblN0cmluZ0xpc3QgPSBmb3JtYXRUb2tlbi5jb250ZW50LnNwbGl0KCcnKQogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdG9rZW5TdHJpbmdMaXN0Lmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRva2VuU3RyaW5nTGlzdFtqXQogICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudDogSUVsZW1lbnQgPSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0VG9rZW4uY29sb3IpIHsKICAgICAgICAgICAgICAgICAgZWxlbWVudC5jb2xvciA9IGZvcm1hdFRva2VuLmNvbG9yCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0VG9rZW4uYm9sZCkgewogICAgICAgICAgICAgICAgICBlbGVtZW50LmJvbGQgPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZm9ybWF0VG9rZW4uaXRhbGljKSB7CiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaXRhbGljID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxlbWVudExpc3QucHVzaChlbGVtZW50KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbGVtZW50TGlzdC51bnNoaWZ0KHsKICAgICAgICAgICAgICB2YWx1ZTogJ1xuJwogICAgICAgICAgICB9KQogICAgICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVJbnNlcnRFbGVtZW50TGlzdChlbGVtZW50TGlzdCkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CgogICAgY29uc3QgY29udHJvbERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAnLm1lbnUtaXRlbV9fY29udHJvbCcKICAgICAgKSAhCiAgICAgIGNvbnN0IGNvbnRyb2xPcHRpb25Eb20gPSBjb250cm9sRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgY29udHJvbERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ2NvbnRyb2wnKQogICAgICAgICAgY29udHJvbE9wdGlvbkRvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgICB9CiAgICBjb250cm9sT3B0aW9uRG9tLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKGV2dCkgewogICAgICBjb250cm9sT3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICBjb25zdCBsaSA9IGV2dC50YXJnZXQgYXMgSFRNTExJRWxlbWVudAogICAgICBjb25zdCB0eXBlID0gPCBDb250cm9sVHlwZSA+IGxpLmRhdGFzZXQuY29udHJvbAogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIENvbnRyb2xUeXBlLlRFWFQ6CiAgICAgICAgICBuZXcgRGlhbG9nKHsKICAgICAgICAgICAgdGl0bGU6ICfmlofmnKzmjqfku7YnLAogICAgICAgICAgICBkYXRhOiBbewogICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgbGFiZWw6ICfnu5HlrprlrZfmrrUnLAogICAgICAgICAgICAgICAgbmFtZTogJ3pkJywKICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXnu5HlrprlrZfmrrUnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICBsYWJlbDogJ+Wtl+auteWQjeensCcsCiAgICAgICAgICAgICAgICBuYW1lOiAnemRNYycsCiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5a2X5q615ZCN56ewJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgbGFiZWw6ICfljaDkvY3nrKYnLAogICAgICAgICAgICAgICAgbmFtZTogJ3BsYWNlaG9sZGVyJywKICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXljaDkvY3nrKYnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICBsYWJlbDogJ+m7mOiupOWAvCcsCiAgICAgICAgICAgICAgICBuYW1lOiAndmFsdWUnLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXpu5jorqTlgLwnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBvbkNvbmZpcm06IHBheWxvYWQgPT4gewogICAgICAgICAgICAgIGxldCBwbGFjZWhvbGRlcjEgPSBwYXlsb2FkLmZpbmQoCiAgICAgICAgICAgICAgICBwID0+IHAubmFtZSA9PT0gJ3BsYWNlaG9sZGVyJwogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjb25zdCBwbGFjZWhvbGRlciA9ICEhcGxhY2Vob2xkZXIxID8gcGxhY2Vob2xkZXIxLnZhbHVlIDogbnVsbAogICAgICAgICAgICAgIGlmICghcGxhY2Vob2xkZXIpIHJldHVybgogICAgICAgICAgICAgIGxldCB2YWx1ZTEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd2YWx1ZScpCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAhIXZhbHVlMSA/IHZhbHVlMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgbGV0IGxhYmVsTmFtZTEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd6ZE1jJykKICAgICAgICAgICAgICBjb25zdCBsYWJlbE5hbWUgPSAhIWxhYmVsTmFtZTEgPyBsYWJlbE5hbWUxLnZhbHVlIDogJycKICAgICAgICAgICAgICBsZXQgbGFiZWxaZDEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd6ZCcpCiAgICAgICAgICAgICAgY29uc3QgbGFiZWxaZCA9ICEhbGFiZWxaZDEgPyBsYWJlbFpkMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICAgICAgICAgIHR5cGU6IEVsZW1lbnRUeXBlLkNPTlRST0wsCiAgICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgICBjb250cm9sOiB7CiAgICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSA/IFt7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUKICAgICAgICAgICAgICAgICAgfV0gOiBudWxsLAogICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlciwKICAgICAgICAgICAgICAgICAgbGFiZWxOYW1lLAogICAgICAgICAgICAgICAgICBsYWJlbFpkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfV0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgQ29udHJvbFR5cGUuU0VMRUNUOgogICAgICAgICAgbmV3IERpYWxvZyh7CiAgICAgICAgICAgIHRpdGxlOiAn5YiX5Li+5o6n5Lu2JywKICAgICAgICAgICAgZGF0YTogW3sKICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgIGxhYmVsOiAn57uR5a6a5a2X5q61JywKICAgICAgICAgICAgICAgIG5hbWU6ICd6ZCcsCiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl57uR5a6a5a2X5q61JwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgbGFiZWw6ICflrZfmrrXlkI3np7AnLAogICAgICAgICAgICAgICAgbmFtZTogJ3pkTWMnLAogICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeWtl+auteWQjeensCcKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICAgIGxhYmVsOiAn5Y2g5L2N56ymJywKICAgICAgICAgICAgICAgIG5hbWU6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5Y2g5L2N56ymJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgbGFiZWw6ICfpu5jorqTlgLwnLAogICAgICAgICAgICAgICAgbmFtZTogJ2NvZGUnLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXpu5jorqTlgLwnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dGFyZWEnLAogICAgICAgICAgICAgICAgbGFiZWw6ICflgLzpm4YnLAogICAgICAgICAgICAgICAgbmFtZTogJ3ZhbHVlU2V0cycsCiAgICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGhlaWdodDogMTAwLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGDor7fovpPlhaXlgLzpm4ZKU09O77yM5L6L77yaXG5be1xuInZhbHVlIjoi5pyJIixcbiJjb2RlIjoiOTgxNzUiXG59XWAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIG9uQ29uZmlybTogcGF5bG9hZCA9PiB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coVnVlLnByb3RvdHlwZSkKICAgICAgICAgICAgICAvLyBWdWUucHJvdG90eXBlLiRtZXNzYWdlLndhcm5pbmdBbGVydCgi5o+Q56S6IiwgJ+aPkOekuuS/oeaBrycpCiAgICAgICAgICAgICAgbGV0IHBsYWNlaG9sZGVyMSA9IHBheWxvYWQuZmluZCgKICAgICAgICAgICAgICAgIHAgPT4gcC5uYW1lID09PSAncGxhY2Vob2xkZXInCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGNvbnN0IHBsYWNlaG9sZGVyID0gISFwbGFjZWhvbGRlcjEgPyBwbGFjZWhvbGRlcjEudmFsdWUgOiAnJwogICAgICAgICAgICAgIGlmICghcGxhY2Vob2xkZXIpIHJldHVybgogICAgICAgICAgICAgIGxldCB2YWx1ZVNldHMxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAndmFsdWVTZXRzJykKICAgICAgICAgICAgICBjb25zdCB2YWx1ZVNldHMgPSAhIXZhbHVlU2V0czEgPyB2YWx1ZVNldHMxLnZhbHVlIDogJycKICAgICAgICAgICAgICBpZiAoIXZhbHVlU2V0cykgcmV0dXJuCiAgICAgICAgICAgICAgbGV0IGNvZGUxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAnY29kZScpCiAgICAgICAgICAgICAgY29uc3QgY29kZSA9ICEhY29kZTEgPyBjb2RlMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgbGV0IGxhYmVsTmFtZTEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd6ZE1jJykKICAgICAgICAgICAgICBjb25zdCBsYWJlbE5hbWUgPSAhIWxhYmVsTmFtZTEgPyBsYWJlbE5hbWUxLnZhbHVlIDogJycKICAgICAgICAgICAgICBsZXQgbGFiZWxaZDEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd6ZCcpCiAgICAgICAgICAgICAgY29uc3QgbGFiZWxaZCA9ICEhbGFiZWxaZDEgPyBsYWJlbFpkMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICAgICAgICAgIHR5cGU6IEVsZW1lbnRUeXBlLkNPTlRST0wsCiAgICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgICBjb250cm9sOiB7CiAgICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICAgIGxhYmVsTmFtZSwKICAgICAgICAgICAgICAgICAgbGFiZWxaZCwKICAgICAgICAgICAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyLAogICAgICAgICAgICAgICAgICB2YWx1ZVNldHM6IEpTT04ucGFyc2UodmFsdWVTZXRzKQogICAgICAgICAgICAgICAgICAvLyB2YWx1ZVNldHM6IEpTT04ucGFyc2UodmFsdWVTZXRzKQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSBDb250cm9sVHlwZS5DSEVDS0JPWDoKICAgICAgICAgIG5ldyBEaWFsb2coewogICAgICAgICAgICB0aXRsZTogJ+WkjemAieahhuaOp+S7ticsCiAgICAgICAgICAgIGRhdGE6IFt7CiAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgICBsYWJlbDogJ+m7mOiupOWAvCcsCiAgICAgICAgICAgICAgICBuYW1lOiAnY29kZScsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpem7mOiupOWAvO+8jOWkmuS4quWAvOS7peiLseaWh+mAl+WPt+WIhuWJsicKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0YXJlYScsCiAgICAgICAgICAgICAgICBsYWJlbDogJ+WAvOmbhicsCiAgICAgICAgICAgICAgICBuYW1lOiAndmFsdWVTZXRzJywKICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogYOivt+i+k+WFpeWAvOmbhkpTT07vvIzkvovvvJpcblt7XG4idmFsdWUiOiLmnIkiLFxuImNvZGUiOiI5ODE3NSJcbn1dYAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgb25Db25maXJtOiBwYXlsb2FkID0+IHsKICAgICAgICAgICAgICBsZXQgdmFsdWVTZXRzMSA9IHBheWxvYWQuZmluZChwID0+IHAubmFtZSA9PT0gJ3ZhbHVlU2V0cycpCiAgICAgICAgICAgICAgY29uc3QgdmFsdWVTZXRzID0gISF2YWx1ZVNldHMxID8gdmFsdWVTZXRzMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgaWYgKCF2YWx1ZVNldHMpIHJldHVybgogICAgICAgICAgICAgIGxldCBjb2RlMSA9IHBheWxvYWQuZmluZChwID0+IHAubmFtZSA9PT0gJ2NvZGUnKQogICAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAhIWNvZGUxID8gY29kZTEudmFsdWUgOiAnJwogICAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUluc2VydEVsZW1lbnRMaXN0KFt7CiAgICAgICAgICAgICAgICB0eXBlOiBFbGVtZW50VHlwZS5DT05UUk9MLAogICAgICAgICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgICAgICAgY29udHJvbDogewogICAgICAgICAgICAgICAgICB0eXBlLAogICAgICAgICAgICAgICAgICBjb2RlLAogICAgICAgICAgICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgdmFsdWVTZXRzOiBKU09OLnBhcnNlKHZhbHVlU2V0cykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9XSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBjaGVja2JveERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAnLm1lbnUtaXRlbV9fY2hlY2tib3gnCiAgICAgICkgIQogICAgICBjaGVja2JveERvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdjaGVja2JveCcsIGluc3RhbmNlLmNvbW1hbmQuZ2V0SFRNTCgpLm1haW4pCiAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICAgIHR5cGU6IEVsZW1lbnRUeXBlLkNIRUNLQk9YLAogICAgICAgICAgdmFsdWU6ICcnCiAgICAgICAgfV0pCiAgICAgIH0KCiAgICBjb25zdCBsYXRleERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fbGF0ZXgnKSAhCiAgICAgIGxhdGV4RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ0xhVGVYJykKICAgICAgICBuZXcgRGlhbG9nKHsKICAgICAgICAgIHRpdGxlOiAnTGFUZVgnLAogICAgICAgICAgZGF0YTogW3sKICAgICAgICAgICAgdHlwZTogJ3RleHRhcmVhJywKICAgICAgICAgICAgaGVpZ2h0OiAxMDAsCiAgICAgICAgICAgIG5hbWU6ICd2YWx1ZScsCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWlTGFUZVjmlofmnKwnCiAgICAgICAgICB9XSwKICAgICAgICAgIG9uQ29uZmlybTogcGF5bG9hZCA9PiB7CiAgICAgICAgICAgIGxldCB2YWx1ZTEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd2YWx1ZScpCiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gISF2YWx1ZTEgPyB2YWx1ZTEudmFsdWUgOiAnJwogICAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm4KICAgICAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICAgICAgICB0eXBlOiBFbGVtZW50VHlwZS5MQVRFWCwKICAgICAgICAgICAgICB2YWx1ZQogICAgICAgICAgICB9XSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CgogICAgY29uc3QgZGF0ZURvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbV9fZGF0ZScpICEKICAgICAgY29uc3QgZGF0ZURvbU9wdGlvbkRvbSA9IGRhdGVEb20ucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcub3B0aW9ucycpICEKICAgICAgICBkYXRlRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnZGF0ZScpCiAgICAgICAgICBkYXRlRG9tT3B0aW9uRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICAgICAgLy8g5a6a5L2N6LCD5pW0CiAgICAgICAgICBjb25zdCBib2R5UmVjdCA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKICAgICAgICAgIGNvbnN0IGRhdGVEb21PcHRpb25SZWN0ID0gZGF0ZURvbU9wdGlvbkRvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICAgICAgaWYgKGRhdGVEb21PcHRpb25SZWN0LmxlZnQgKyBkYXRlRG9tT3B0aW9uUmVjdC53aWR0aCA+IGJvZHlSZWN0LndpZHRoKSB7CiAgICAgICAgICAgIGRhdGVEb21PcHRpb25Eb20uc3R5bGUucmlnaHQgPSAnMHB4JwogICAgICAgICAgICBkYXRlRG9tT3B0aW9uRG9tLnN0eWxlLmxlZnQgPSAndW5zZXQnCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRlRG9tT3B0aW9uRG9tLnN0eWxlLnJpZ2h0ID0gJ3Vuc2V0JwogICAgICAgICAgICBkYXRlRG9tT3B0aW9uRG9tLnN0eWxlLmxlZnQgPSAnMHB4JwogICAgICAgICAgfQogICAgICAgICAgLy8g5b2T5YmN5pel5pyfCiAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKQogICAgICAgICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpCiAgICAgICAgICBjb25zdCBtb250aCA9IChkYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykKICAgICAgICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKQogICAgICAgICAgY29uc3QgaG91ciA9IGRhdGUuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykKICAgICAgICAgIGNvbnN0IG1pbnV0ZSA9IGRhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKQogICAgICAgICAgY29uc3Qgc2Vjb25kID0gZGF0ZS5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpCiAgICAgICAgICBjb25zdCBkYXRlU3RyaW5nID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YAogICAgICAgICAgY29uc3QgZGF0ZVRpbWVTdHJpbmcgPSBgJHtkYXRlU3RyaW5nfSAke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH1gCiAgICAgICAgICBkYXRlRG9tT3B0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MTElFbGVtZW50ID4gKCdsaTpmaXJzdC1jaGlsZCcpICEuaW5uZXJUZXh0ID0KICAgICAgICAgICAgZGF0ZVN0cmluZwogICAgICAgICAgZGF0ZURvbU9wdGlvbkRvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTExJRWxlbWVudCA+ICgnbGk6bGFzdC1jaGlsZCcpICEuaW5uZXJUZXh0ID0KICAgICAgICAgICAgZGF0ZVRpbWVTdHJpbmcKICAgICAgICB9CiAgICBkYXRlRG9tT3B0aW9uRG9tLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKGV2dCkgewogICAgICBkZWJ1Z2dlcgogICAgICBjb25zdCBsaSA9IGV2dC50YXJnZXQgYXMgSFRNTExJRWxlbWVudAogICAgICBjb25zdCBkYXRlRm9ybWF0ID0gbGkuZGF0YXNldC5mb3JtYXQhCiAgICAgICAgZGF0ZURvbU9wdGlvbkRvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICB0eXBlOiBFbGVtZW50VHlwZS5EQVRFLAogICAgICAgIHZhbHVlOiAnJywKICAgICAgICBkYXRlRm9ybWF0LAogICAgICAgIHZhbHVlTGlzdDogW3sKICAgICAgICAgIHZhbHVlOiBsaS5pbm5lclRleHQudHJpbSgpCiAgICAgICAgfV0KICAgICAgfV0pCiAgICB9CgogICAgY29uc3QgYmxvY2tEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5tZW51LWl0ZW1fX2Jsb2NrJykgIQogICAgICBibG9ja0RvbS5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdibG9jaycpCiAgICAgICAgbmV3IERpYWxvZyh7CiAgICAgICAgICB0aXRsZTogJ+WGheWuueWdlycsCiAgICAgICAgICBkYXRhOiBbewogICAgICAgICAgICAgIHR5cGU6ICdzZWxlY3QnLAogICAgICAgICAgICAgIGxhYmVsOiAn57G75Z6LJywKICAgICAgICAgICAgICBuYW1lOiAndHlwZScsCiAgICAgICAgICAgICAgdmFsdWU6ICdpZnJhbWUnLAogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIG9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICAgIGxhYmVsOiAn572R5Z2AJywKICAgICAgICAgICAgICAgICAgdmFsdWU6ICdpZnJhbWUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBsYWJlbDogJ+inhumikScsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiAndmlkZW8nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdHlwZTogJ251bWJlcicsCiAgICAgICAgICAgICAgbGFiZWw6ICflrr3luqYnLAogICAgICAgICAgICAgIG5hbWU6ICd3aWR0aCcsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXlrr3luqbvvIjpu5jorqTpobXpnaLlhoXlrr3luqbvvIknCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0eXBlOiAnbnVtYmVyJywKICAgICAgICAgICAgICBsYWJlbDogJ+mrmOW6picsCiAgICAgICAgICAgICAgbmFtZTogJ2hlaWdodCcsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXpq5jluqYnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0eXBlOiAndGV4dGFyZWEnLAogICAgICAgICAgICAgIGxhYmVsOiAn5Zyw5Z2AJywKICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCwKICAgICAgICAgICAgICBuYW1lOiAndmFsdWUnLAogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5Zyw5Z2AJwogICAgICAgICAgICB9CiAgICAgICAgICBdLAogICAgICAgICAgb25Db25maXJtOiBwYXlsb2FkID0+IHsKICAgICAgICAgICAgbGV0IHR5cGUxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAndHlwZScpCiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSAhIXR5cGUxID8gdHlwZTEudmFsdWUgOiAnJwogICAgICAgICAgICBpZiAoIXR5cGUpIHJldHVybgogICAgICAgICAgICBsZXQgdmFsdWUxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAndmFsdWUnKQogICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICEhdmFsdWUxID8gdmFsdWUxLnZhbHVlIDogJycKICAgICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuCiAgICAgICAgICAgIGxldCB3aWR0aDEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICd3aWR0aCcpCiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gISF3aWR0aDEgPyB3aWR0aDEudmFsdWUgOiAnJwogICAgICAgICAgICBsZXQgaGVpZ2h0MSA9IHBheWxvYWQuZmluZChwID0+IHAubmFtZSA9PT0gJ2hlaWdodCcpCiAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9ICEhaGVpZ2h0MSA/IGhlaWdodDEudmFsdWUgOiAnJwogICAgICAgICAgICBpZiAoIWhlaWdodCkgcmV0dXJuCiAgICAgICAgICAgIGNvbnN0IGJsb2NrOiBJQmxvY2sgPSB7CiAgICAgICAgICAgICAgdHlwZTogPCBCbG9ja1R5cGUgPiB0eXBlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJsb2NrLnR5cGUgPT09IEJsb2NrVHlwZS5JRlJBTUUpIHsKICAgICAgICAgICAgICBibG9jay5pZnJhbWVCbG9jayA9IHsKICAgICAgICAgICAgICAgIHNyYzogdmFsdWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYmxvY2sudHlwZSA9PT0gQmxvY2tUeXBlLlZJREVPKSB7CiAgICAgICAgICAgICAgYmxvY2sudmlkZW9CbG9jayA9IHsKICAgICAgICAgICAgICAgIHNyYzogdmFsdWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYmxvY2tFbGVtZW50OiBJRWxlbWVudCA9IHsKICAgICAgICAgICAgICB0eXBlOiBFbGVtZW50VHlwZS5CTE9DSywKICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgaGVpZ2h0OiBOdW1iZXIoaGVpZ2h0KSwKICAgICAgICAgICAgICBibG9jawogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3aWR0aCkgewogICAgICAgICAgICAgIGJsb2NrRWxlbWVudC53aWR0aCA9IE51bWJlcih3aWR0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVJbnNlcnRFbGVtZW50TGlzdChbYmxvY2tFbGVtZW50XSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CgogICAgLy8gNS4gfCDmkJzntKIm5pu/5o2iIHwg5omT5Y2wIHwKICAgIGNvbnN0IHNlYXJjaENvbGxhcHNlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKAogICAgICAgICcubWVudS1pdGVtX19zZWFyY2hfX2NvbGxhcHNlJwogICAgICApICEKICAgICAgY29uc3Qgc2VhcmNoSW5wdXREb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTElucHV0RWxlbWVudCA+ICgKICAgICAgICAgICcubWVudS1pdGVtX19zZWFyY2hfX2NvbGxhcHNlX19zZWFyY2ggaW5wdXQnCiAgICAgICAgKSAhCiAgICAgICAgY29uc3QgcmVwbGFjZUlucHV0RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxJbnB1dEVsZW1lbnQgPiAoCiAgICAgICAgICAgICcubWVudS1pdGVtX19zZWFyY2hfX2NvbGxhcHNlX19yZXBsYWNlIGlucHV0JwogICAgICAgICAgKSAhCiAgICAgICAgICBjb25zdCBzZWFyY2hEb20gPQogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5tZW51LWl0ZW1fX3NlYXJjaCcpICEKICAgICAgICAgICAgc2VhcmNoRG9tLnRpdGxlID0gYOaQnOe0ouS4juabv+aNoigke2lzQXBwbGUgPyAn4oyYJyA6ICdDdHJsJ30rRilgCiAgICBjb25zdCBzZWFyY2hSZXN1bHREb20gPQogICAgICBzZWFyY2hDb2xsYXBzZURvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTExhYmVsRWxlbWVudCA+ICgnLnNlYXJjaC1yZXN1bHQnKSAhCiAgICAgIGZ1bmN0aW9uIHNldFNlYXJjaFJlc3VsdCgpIHsKICAgICAgICBjb25zdCByZXN1bHQgPSBpbnN0YW5jZS5jb21tYW5kLmdldFNlYXJjaE5hdmlnYXRlSW5mbygpCiAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBpbmRleCwKICAgICAgICAgICAgY291bnQKICAgICAgICAgIH0gPSByZXN1bHQKICAgICAgICAgIHNlYXJjaFJlc3VsdERvbS5pbm5lclRleHQgPSBgJHtpbmRleH0vJHtjb3VudH1gCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlYXJjaFJlc3VsdERvbS5pbm5lclRleHQgPSAnJwogICAgICAgIH0KICAgICAgfQogICAgc2VhcmNoRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdzZWFyY2gnKQogICAgICBzZWFyY2hDb2xsYXBzZURvbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJwogICAgICBjb25zdCBib2R5UmVjdCA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKICAgICAgY29uc3Qgc2VhcmNoUmVjdCA9IHNlYXJjaERvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICBjb25zdCBzZWFyY2hDb2xsYXBzZVJlY3QgPSBzZWFyY2hDb2xsYXBzZURvbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICBpZiAoc2VhcmNoUmVjdC5sZWZ0ICsgc2VhcmNoQ29sbGFwc2VSZWN0LndpZHRoID4gYm9keVJlY3Qud2lkdGgpIHsKICAgICAgICBzZWFyY2hDb2xsYXBzZURvbS5zdHlsZS5yaWdodCA9ICcwcHgnCiAgICAgICAgc2VhcmNoQ29sbGFwc2VEb20uc3R5bGUubGVmdCA9ICd1bnNldCcKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWFyY2hDb2xsYXBzZURvbS5zdHlsZS5yaWdodCA9ICd1bnNldCcKICAgICAgfQogICAgICBzZWFyY2hJbnB1dERvbS5mb2N1cygpCiAgICB9CiAgICBzZWFyY2hDb2xsYXBzZURvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTFNwYW5FbGVtZW50ID4gKCdzcGFuJykgIS5vbmNsaWNrID0KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIHNlYXJjaENvbGxhcHNlRG9tLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScKICAgICAgICBzZWFyY2hJbnB1dERvbS52YWx1ZSA9ICcnCiAgICAgICAgcmVwbGFjZUlucHV0RG9tLnZhbHVlID0gJycKICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTZWFyY2gobnVsbCkKICAgICAgICBzZXRTZWFyY2hSZXN1bHQoKQogICAgICB9CiAgICBzZWFyY2hJbnB1dERvbS5vbmlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTZWFyY2goc2VhcmNoSW5wdXREb20udmFsdWUgfHwgbnVsbCkKICAgICAgc2V0U2VhcmNoUmVzdWx0KCkKICAgIH0KICAgIHNlYXJjaElucHV0RG9tLm9ua2V5ZG93biA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgaWYgKGV2dC5rZXkgPT09ICdFbnRlcicpIHsKICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTZWFyY2goc2VhcmNoSW5wdXREb20udmFsdWUgfHwgbnVsbCkKICAgICAgICBzZXRTZWFyY2hSZXN1bHQoKQogICAgICB9CiAgICB9CiAgICBzZWFyY2hDb2xsYXBzZURvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTEJ1dHRvbkVsZW1lbnQgPiAoJ2J1dHRvbicpICEub25jbGljayA9CiAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICBjb25zdCBzZWFyY2hWYWx1ZSA9IHNlYXJjaElucHV0RG9tLnZhbHVlCiAgICAgICAgY29uc3QgcmVwbGFjZVZhbHVlID0gcmVwbGFjZUlucHV0RG9tLnZhbHVlCiAgICAgICAgaWYgKHNlYXJjaFZhbHVlICYmIHJlcGxhY2VWYWx1ZSAmJiBzZWFyY2hWYWx1ZSAhPT0gcmVwbGFjZVZhbHVlKSB7CiAgICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVSZXBsYWNlKHJlcGxhY2VWYWx1ZSkKICAgICAgICB9CiAgICAgIH0KICAgIHNlYXJjaENvbGxhcHNlRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLmFycm93LWxlZnQnKSAhLm9uY2xpY2sgPQogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlU2VhcmNoTmF2aWdhdGVQcmUoKQogICAgICAgIHNldFNlYXJjaFJlc3VsdCgpCiAgICAgIH0KICAgIHNlYXJjaENvbGxhcHNlRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLmFycm93LXJpZ2h0JykgIS5vbmNsaWNrID0KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVNlYXJjaE5hdmlnYXRlTmV4dCgpCiAgICAgICAgc2V0U2VhcmNoUmVzdWx0KCkKICAgICAgfQoKICAgIGNvbnN0IHByaW50RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcubWVudS1pdGVtX19wcmludCcpICEKICAgICAgcHJpbnREb20udGl0bGUgPSBg5omT5Y2wKCR7aXNBcHBsZSA/ICfijJgnIDogJ0N0cmwnfStQKWAKICAgIHByaW50RG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnNvbGUubG9nKCdwcmludCcpCiAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVByaW50KCkKICAgIH0KCiAgICAvLyA2LiDnm67lvZXmmL7pmpAgfCDpobXpnaLmqKHlvI8gfCDnurjlvKDnvKnmlL4gfCDnurjlvKDlpKflsI8gfCDnurjlvKDmlrnlkJEgfCDpobXovrnot50gfCDlhajlsY8KICAgIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNhdGFsb2coKSB7CiAgICAgIGNvbnN0IGNhdGFsb2cgPSBhd2FpdCBpbnN0YW5jZS5jb21tYW5kLmdldENhdGFsb2coKQogICAgICBjb25zdCBjYXRhbG9nTWFpbkRvbSA9CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcuY2F0YWxvZ19fbWFpbicpICEKICAgICAgICBjYXRhbG9nTWFpbkRvbS5pbm5lckhUTUwgPSAnJwogICAgICBpZiAoY2F0YWxvZykgewogICAgICAgIGNvbnN0IGFwcGVuZENhdGFsb2cgPSAoCiAgICAgICAgICBwYXJlbnQ6IEhUTUxEaXZFbGVtZW50LAogICAgICAgICAgY2F0YWxvZ0l0ZW1zOiBJQ2F0YWxvZ0l0ZW1bXQogICAgICAgICkgPT4gewogICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjYXRhbG9nSXRlbXMubGVuZ3RoOyBjKyspIHsKICAgICAgICAgICAgY29uc3QgY2F0YWxvZ0l0ZW0gPSBjYXRhbG9nSXRlbXNbY10KICAgICAgICAgICAgY29uc3QgY2F0YWxvZ0l0ZW1Eb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgICAgICAgICBjYXRhbG9nSXRlbURvbS5jbGFzc0xpc3QuYWRkKCdjYXRhbG9nLWl0ZW0nKQogICAgICAgICAgICAvLyDmuLLmn5MKICAgICAgICAgICAgY29uc3QgY2F0YWxvZ0l0ZW1Db250ZW50RG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICAgICAgY2F0YWxvZ0l0ZW1Db250ZW50RG9tLmNsYXNzTGlzdC5hZGQoJ2NhdGFsb2ctaXRlbV9fY29udGVudCcpCiAgICAgICAgICAgIGNvbnN0IGNhdGFsb2dJdGVtQ29udGVudFNwYW5Eb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykKICAgICAgICAgICAgY2F0YWxvZ0l0ZW1Db250ZW50U3BhbkRvbS5pbm5lclRleHQgPSBjYXRhbG9nSXRlbS5uYW1lCiAgICAgICAgICAgIGNhdGFsb2dJdGVtQ29udGVudERvbS5hcHBlbmQoY2F0YWxvZ0l0ZW1Db250ZW50U3BhbkRvbSkKICAgICAgICAgICAgLy8g5a6a5L2NCiAgICAgICAgICAgIGNhdGFsb2dJdGVtQ29udGVudERvbS5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUxvY2F0aW9uQ2F0YWxvZyhjYXRhbG9nSXRlbS5pZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRhbG9nSXRlbURvbS5hcHBlbmQoY2F0YWxvZ0l0ZW1Db250ZW50RG9tKQogICAgICAgICAgICBpZiAoY2F0YWxvZ0l0ZW0uc3ViQ2F0YWxvZyAmJiBjYXRhbG9nSXRlbS5zdWJDYXRhbG9nLmxlbmd0aCkgewogICAgICAgICAgICAgIGFwcGVuZENhdGFsb2coY2F0YWxvZ0l0ZW1Eb20sIGNhdGFsb2dJdGVtLnN1YkNhdGFsb2cpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g6L+95YqgCiAgICAgICAgICAgIHBhcmVudC5hcHBlbmQoY2F0YWxvZ0l0ZW1Eb20pCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFwcGVuZENhdGFsb2coY2F0YWxvZ01haW5Eb20sIGNhdGFsb2cpCiAgICAgIH0KICAgIH0KICAgIGxldCBpc0NhdGFsb2dTaG93ID0gdHJ1ZQogICAgY29uc3QgY2F0YWxvZ0RvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRWxlbWVudCA+ICgnLmNhdGFsb2cnKSAhCiAgICAgIGNvbnN0IGNhdGFsb2dNb2RlRG9tID0KICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5jYXRhbG9nLW1vZGUnKSAhCiAgICAgICAgY29uc3QgY2F0YWxvZ0hlYWRlckNsb3NlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKAogICAgICAgICAgICAnLmNhdGFsb2dfX2hlYWRlcl9fY2xvc2UnCiAgICAgICAgICApICEKICAgICAgICAgIGNvbnN0IHN3aXRjaENhdGFsb2cgPSAoKSA9PiB7CiAgICAgICAgICAgIGlzQ2F0YWxvZ1Nob3cgPSAhaXNDYXRhbG9nU2hvdwogICAgICAgICAgICBpZiAoaXNDYXRhbG9nU2hvdykgewogICAgICAgICAgICAgIGNhdGFsb2dEb20uc3R5bGUuZGlzcGxheSA9ICdibG9jaycKICAgICAgICAgICAgICB1cGRhdGVDYXRhbG9nKCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjYXRhbG9nRG9tLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgY2F0YWxvZ01vZGVEb20ub25jbGljayA9IHN3aXRjaENhdGFsb2cKICAgIC8vIGNhdGFsb2dIZWFkZXJDbG9zZURvbS5vbmNsaWNrID0gc3dpdGNoQ2F0YWxvZwoKICAgIGNvbnN0IHBhZ2VNb2RlRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcucGFnZS1tb2RlJykgIQogICAgICBjb25zdCBwYWdlTW9kZU9wdGlvbnNEb20gPQogICAgICAgIHBhZ2VNb2RlRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgcGFnZU1vZGVEb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHBhZ2VNb2RlT3B0aW9uc0RvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgICB9CiAgICBwYWdlTW9kZU9wdGlvbnNEb20ub25jbGljayA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgY29uc3QgbGkgPSBldnQudGFyZ2V0IGFzIEhUTUxMSUVsZW1lbnQKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlUGFnZU1vZGUoIDwgUGFnZU1vZGUgPiBsaS5kYXRhc2V0LnBhZ2VNb2RlISkKICAgIH0KCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5wYWdlLXNjYWxlLXBlcmNlbnRhZ2UnKSAhLm9uY2xpY2sgPQogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ3BhZ2Utc2NhbGUtcmVjb3ZlcnknKQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVBhZ2VTY2FsZVJlY292ZXJ5KCkKICAgICAgfQoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLnBhZ2Utc2NhbGUtbWludXMnKSAhLm9uY2xpY2sgPQogICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ3BhZ2Utc2NhbGUtbWludXMnKQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVBhZ2VTY2FsZU1pbnVzKCkKICAgICAgfQoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLnBhZ2Utc2NhbGUtYWRkJykgIS5vbmNsaWNrID0KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKCdwYWdlLXNjYWxlLWFkZCcpCiAgICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlUGFnZVNjYWxlQWRkKCkKICAgICAgfQoKICAgIC8vIOe6uOW8oOWkp+WwjwogICAgY29uc3QgcGFwZXJTaXplRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcucGFwZXItc2l6ZScpICEKICAgICAgY29uc3QgcGFwZXJTaXplRG9tT3B0aW9uc0RvbSA9CiAgICAgICAgcGFwZXJTaXplRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgcGFwZXJTaXplRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBwYXBlclNpemVEb21PcHRpb25zRG9tLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKQogICAgICAgIH0KICAgIHBhcGVyU2l6ZURvbU9wdGlvbnNEb20ub25jbGljayA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgY29uc3QgbGkgPSBldnQudGFyZ2V0IGFzIEhUTUxMSUVsZW1lbnQKICAgICAgY29uc3QgcGFwZXJUeXBlID0gbGkuZGF0YXNldC5wYXBlclNpemUhCiAgICAgICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gcGFwZXJUeXBlLnNwbGl0KCcqJykubWFwKE51bWJlcikKICAgICAgaW5zdGFuY2UuY29tbWFuZC5leGVjdXRlUGFwZXJTaXplKHdpZHRoLCBoZWlnaHQpCiAgICAgIC8vIOe6uOW8oOeKtuaAgeWbnuaYvgogICAgICBwYXBlclNpemVEb21PcHRpb25zRG9tCiAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykKICAgICAgICAuZm9yRWFjaChjaGlsZCA9PiBjaGlsZC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgbGkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgIH0KCiAgICAvLyDnurjlvKDmlrnlkJEKICAgIGNvbnN0IHBhcGVyRGlyZWN0aW9uRG9tID0KICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcucGFwZXItZGlyZWN0aW9uJykgIQogICAgICBjb25zdCBwYXBlckRpcmVjdGlvbkRvbU9wdGlvbnNEb20gPQogICAgICAgIHBhcGVyRGlyZWN0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm9wdGlvbnMnKSAhCiAgICAgICAgcGFwZXJEaXJlY3Rpb25Eb20ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHBhcGVyRGlyZWN0aW9uRG9tT3B0aW9uc0RvbS5jbGFzc0xpc3QudG9nZ2xlKCd2aXNpYmxlJykKICAgICAgICB9CiAgICBwYXBlckRpcmVjdGlvbkRvbU9wdGlvbnNEb20ub25jbGljayA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgY29uc3QgbGkgPSBldnQudGFyZ2V0IGFzIEhUTUxMSUVsZW1lbnQKICAgICAgY29uc3QgcGFwZXJEaXJlY3Rpb24gPSBsaS5kYXRhc2V0LnBhcGVyRGlyZWN0aW9uIQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVBhcGVyRGlyZWN0aW9uKCA8IFBhcGVyRGlyZWN0aW9uID4gcGFwZXJEaXJlY3Rpb24pCiAgICAgIC8vIOe6uOW8oOaWueWQkeeKtuaAgeWbnuaYvgogICAgICBwYXBlckRpcmVjdGlvbkRvbU9wdGlvbnNEb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnbGknKQogICAgICAgIC5mb3JFYWNoKGNoaWxkID0+IGNoaWxkLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKQogICAgICBsaS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQogICAgfQoKICAgIC8vIOmhtemdoui+uei3nQogICAgY29uc3QgcGFwZXJNYXJnaW5Eb20gPQogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5wYXBlci1tYXJnaW4nKSAhCiAgICAgIHBhcGVyTWFyZ2luRG9tLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY29uc3QgW3RvcE1hcmdpbiwgcmlnaHRNYXJnaW4sIGJvdHRvbU1hcmdpbiwgbGVmdE1hcmdpbl0gPQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZ2V0UGFwZXJNYXJnaW4oKQogICAgICAgIG5ldyBEaWFsb2coewogICAgICAgICAgdGl0bGU6ICfpobXovrnot50nLAogICAgICAgICAgZGF0YTogW3sKICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgbGFiZWw6ICfkuIrovrnot50nLAogICAgICAgICAgICAgIG5hbWU6ICd0b3AnLAogICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICAgIHZhbHVlOiBgJHt0b3BNYXJnaW59YCwKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeS4iui+uei3nScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICBsYWJlbDogJ+S4i+i+uei3nScsCiAgICAgICAgICAgICAgbmFtZTogJ2JvdHRvbScsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgdmFsdWU6IGAke2JvdHRvbU1hcmdpbn1gLAogICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAn6K+36L6T5YWl5LiL6L656LedJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgIGxhYmVsOiAn5bem6L656LedJywKICAgICAgICAgICAgICBuYW1lOiAnbGVmdCcsCiAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgICAgdmFsdWU6IGAke2xlZnRNYXJnaW59YCwKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeW3pui+uei3nScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICBsYWJlbDogJ+WPs+i+uei3nScsCiAgICAgICAgICAgICAgbmFtZTogJ3JpZ2h0JywKICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICB2YWx1ZTogYCR7cmlnaHRNYXJnaW59YCwKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeWPs+i+uei3nScKICAgICAgICAgICAgfQogICAgICAgICAgXSwKICAgICAgICAgIG9uQ29uZmlybTogcGF5bG9hZCA9PiB7CiAgICAgICAgICAgIGxldCB0b3AxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAndG9wJykKICAgICAgICAgICAgY29uc3QgdG9wID0gISF0b3AxID8gdG9wMS52YWx1ZSA6IG51bGwKICAgICAgICAgICAgaWYgKCF0b3ApIHJldHVybgogICAgICAgICAgICBsZXQgYm90dG9tMSA9IHBheWxvYWQuZmluZChwID0+IHAubmFtZSA9PT0gJ2JvdHRvbScpCiAgICAgICAgICAgIGNvbnN0IGJvdHRvbSA9ICEhYm90dG9tMSA/IGJvdHRvbTEudmFsdWUgOiBudWxsCiAgICAgICAgICAgIGlmICghYm90dG9tKSByZXR1cm4KICAgICAgICAgICAgbGV0IGxlZnQxID0gcGF5bG9hZC5maW5kKHAgPT4gcC5uYW1lID09PSAnbGVmdCcpCiAgICAgICAgICAgIGNvbnN0IGxlZnQgPSAhIWxlZnQxID8gbGVmdDEudmFsdWUgOiBudWxsCiAgICAgICAgICAgIGlmICghbGVmdCkgcmV0dXJuCiAgICAgICAgICAgIGxldCByaWdodDEgPSBwYXlsb2FkLmZpbmQocCA9PiBwLm5hbWUgPT09ICdyaWdodCcpCiAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gISFyaWdodDEgPyByaWdodDEudmFsdWUgOiBudWxsCiAgICAgICAgICAgIGlmICghcmlnaHQpIHJldHVybgogICAgICAgICAgICBpbnN0YW5jZS5jb21tYW5kLmV4ZWN1dGVTZXRQYXBlck1hcmdpbihbCiAgICAgICAgICAgICAgTnVtYmVyKHRvcCksCiAgICAgICAgICAgICAgTnVtYmVyKHJpZ2h0KSwKICAgICAgICAgICAgICBOdW1iZXIoYm90dG9tKSwKICAgICAgICAgICAgICBOdW1iZXIobGVmdCkKICAgICAgICAgICAgXSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CgogICAgLy8g5YWo5bGPCiAgICBjb25zdCBmdWxsc2NyZWVuRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcuZnVsbHNjcmVlbicpICEKICAgICAgZnVsbHNjcmVlbkRvbS5vbmNsaWNrID0gdG9nZ2xlRnVsbHNjcmVlbgogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBldnQgPT4gewogICAgICBpZiAoZXZ0LmtleSA9PT0gJ0YxMScpIHsKICAgICAgICB0b2dnbGVGdWxsc2NyZWVuKCkKICAgICAgICBldnQucHJldmVudERlZmF1bHQoKQogICAgICB9CiAgICB9KQogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsICgpID0+IHsKICAgICAgZnVsbHNjcmVlbkRvbS5jbGFzc0xpc3QudG9nZ2xlKCdleGlzdCcpCiAgICB9KQoKICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7CiAgICAgIGNvbnNvbGUubG9nKCdmdWxsc2NyZWVuJykKICAgICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgewogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbigpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKQogICAgICB9CiAgICB9CgogICAgLy8gNy4g57yW6L6R5Zmo5L2/55So5qih5byPCiAgICBsZXQgbW9kZUluZGV4ID0gMAogICAgY29uc3QgbW9kZUxpc3QgPSBbewogICAgICAgIG1vZGU6IEVkaXRvck1vZGUuRURJVCwKICAgICAgICBuYW1lOiAn57yW6L6R5qih5byPJwogICAgICB9LAogICAgICB7CiAgICAgICAgbW9kZTogRWRpdG9yTW9kZS5DTEVBTiwKICAgICAgICBuYW1lOiAn5riF5rSB5qih5byPJwogICAgICB9LAogICAgICB7CiAgICAgICAgbW9kZTogRWRpdG9yTW9kZS5SRUFET05MWSwKICAgICAgICBuYW1lOiAn5Y+q6K+75qih5byPJwogICAgICB9LAogICAgICB7CiAgICAgICAgbW9kZTogRWRpdG9yTW9kZS5GT1JNLAogICAgICAgIG5hbWU6ICfooajljZXmqKHlvI8nCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBtb2RlOiBFZGl0b3JNb2RlLlBSSU5ULAogICAgICAgIG5hbWU6ICfmiZPljbDmqKHlvI8nCiAgICAgIH0KICAgIF0KICAgIGNvbnN0IG1vZGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKCcuZWRpdG9yLW1vZGUnKSAhCiAgICAgIG1vZGVFbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8g5qih5byP6YCJ5oup5b6q546vCiAgICAgICAgbW9kZUluZGV4ID09PSBtb2RlTGlzdC5sZW5ndGggLSAxID8gKG1vZGVJbmRleCA9IDApIDogbW9kZUluZGV4KysKICAgICAgICAvLyDorr7nva7mqKHlvI8KICAgICAgICBjb25zdCB7CiAgICAgICAgICBuYW1lLAogICAgICAgICAgbW9kZQogICAgICAgIH0gPSBtb2RlTGlzdFttb2RlSW5kZXhdCiAgICAgICAgbW9kZUVsZW1lbnQuaW5uZXJUZXh0ID0gbmFtZQogICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZU1vZGUobW9kZSkKICAgICAgICAvLyDorr7nva7oj5zljZXmoI/mnYPpmZDop4bop4nlj43ppogKICAgICAgICBjb25zdCBpc1JlYWRvbmx5ID0gbW9kZSA9PT0gRWRpdG9yTW9kZS5SRUFET05MWQogICAgICAgIGNvbnN0IGVuYWJsZU1lbnVMaXN0ID0gWydzZWFyY2gnLCAncHJpbnQnXQogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwgPCBIVE1MRGl2RWxlbWVudCA+ICgnLm1lbnUtaXRlbT5kaXYnKS5mb3JFYWNoKGRvbSA9PiB7CiAgICAgICAgICBjb25zdCBtZW51ID0gZG9tLmRhdGFzZXQubWVudQogICAgICAgICAgaXNSZWFkb25seSAmJiAoIW1lbnUgfHwgIWVuYWJsZU1lbnVMaXN0LmluY2x1ZGVzKG1lbnUpKSA/CiAgICAgICAgICAgIGRvbS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlJykgOgogICAgICAgICAgICBkb20uY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZScpCiAgICAgICAgfSkKICAgICAgfQoKICAgIC8vIOaooeaLn+aJueazqAogICAgY29uc3QgY29tbWVudERvbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgnLmNvbW1lbnQnKSAhCiAgICAgIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUNvbW1lbnQoKSB7CiAgICAgICAgY29uc3QgZ3JvdXBJZHMgPSBhd2FpdCBpbnN0YW5jZS5jb21tYW5kLmdldEdyb3VwSWRzKCkKICAgICAgICBmb3IgKGNvbnN0IGNvbW1lbnQgb2YgY29tbWVudExpc3QpIHsKICAgICAgICAgIGNvbnN0IGFjdGl2ZUNvbW1lbnREb20gPSBjb21tZW50RG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAgICAgYC5jb21tZW50LWl0ZW1bZGF0YS1pZD0nJHtjb21tZW50LmlkfSddYAogICAgICAgICAgKQogICAgICAgICAgLy8g57yW6L6R5Zmo5piv5ZCm5a2Y5Zyo5a+55bqU5oiQ57uEaWQKICAgICAgICAgIGlmIChncm91cElkcy5pbmNsdWRlcyhjb21tZW50LmlkKSkgewogICAgICAgICAgICAvLyDlvZPliY1kb23mmK/lkKblrZjlnKgt5LiN5a2Y5Zyo5YiZ6L+95YqgCiAgICAgICAgICAgIGlmICghYWN0aXZlQ29tbWVudERvbSkgewogICAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICAgICAgICBjb21tZW50SXRlbS5jbGFzc0xpc3QuYWRkKCdjb21tZW50LWl0ZW0nKQogICAgICAgICAgICAgIGNvbW1lbnRJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIGNvbW1lbnQuaWQpCiAgICAgICAgICAgICAgY29tbWVudEl0ZW0ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZUxvY2F0aW9uR3JvdXAoY29tbWVudC5pZCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29tbWVudERvbS5hcHBlbmQoY29tbWVudEl0ZW0pCiAgICAgICAgICAgICAgLy8g6YCJ5Yy65L+h5oGvCiAgICAgICAgICAgICAgY29uc3QgY29tbWVudEl0ZW1UaXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICAgICAgICAgICAgY29tbWVudEl0ZW1UaXRsZS5jbGFzc0xpc3QuYWRkKCdjb21tZW50LWl0ZW1fX3RpdGxlJykKICAgICAgICAgICAgICBjb21tZW50SXRlbVRpdGxlLmFwcGVuZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykpCiAgICAgICAgICAgICAgY29uc3QgY29tbWVudEl0ZW1UaXRsZUNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykKICAgICAgICAgICAgICBjb21tZW50SXRlbVRpdGxlQ29udGVudC5pbm5lclRleHQgPSBjb21tZW50LnJhbmdlVGV4dAogICAgICAgICAgICAgIGNvbW1lbnRJdGVtVGl0bGUuYXBwZW5kKGNvbW1lbnRJdGVtVGl0bGVDb250ZW50KQogICAgICAgICAgICAgIGNvbnN0IGNsb3NlRG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpCiAgICAgICAgICAgICAgY2xvc2VEb20ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZURlbGV0ZUdyb3VwKGNvbW1lbnQuaWQpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbW1lbnRJdGVtVGl0bGUuYXBwZW5kKGNsb3NlRG9tKQogICAgICAgICAgICAgIGNvbW1lbnRJdGVtLmFwcGVuZChjb21tZW50SXRlbVRpdGxlKQogICAgICAgICAgICAgIC8vIOWfuuehgOS/oeaBrwogICAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRJdGVtSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICAgICAgICAgICAgY29tbWVudEl0ZW1JbmZvLmNsYXNzTGlzdC5hZGQoJ2NvbW1lbnQtaXRlbV9faW5mbycpCiAgICAgICAgICAgICAgY29uc3QgY29tbWVudEl0ZW1JbmZvTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKQogICAgICAgICAgICAgIGNvbW1lbnRJdGVtSW5mb05hbWUuaW5uZXJUZXh0ID0gY29tbWVudC51c2VyTmFtZQogICAgICAgICAgICAgIGNvbnN0IGNvbW1lbnRJdGVtSW5mb0RhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykKICAgICAgICAgICAgICBjb21tZW50SXRlbUluZm9EYXRlLmlubmVyVGV4dCA9IGNvbW1lbnQuY3JlYXRlZERhdGUKICAgICAgICAgICAgICBjb21tZW50SXRlbUluZm8uYXBwZW5kKGNvbW1lbnRJdGVtSW5mb05hbWUpCiAgICAgICAgICAgICAgY29tbWVudEl0ZW1JbmZvLmFwcGVuZChjb21tZW50SXRlbUluZm9EYXRlKQogICAgICAgICAgICAgIGNvbW1lbnRJdGVtLmFwcGVuZChjb21tZW50SXRlbUluZm8pCiAgICAgICAgICAgICAgLy8g6K+m57uG6K+E6K66CiAgICAgICAgICAgICAgY29uc3QgY29tbWVudEl0ZW1Db250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKICAgICAgICAgICAgICBjb21tZW50SXRlbUNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnY29tbWVudC1pdGVtX19jb250ZW50JykKICAgICAgICAgICAgICBjb21tZW50SXRlbUNvbnRlbnQuaW5uZXJUZXh0ID0gY29tbWVudC5jb250ZW50CiAgICAgICAgICAgICAgY29tbWVudEl0ZW0uYXBwZW5kKGNvbW1lbnRJdGVtQ29udGVudCkKICAgICAgICAgICAgICBjb21tZW50RG9tLmFwcGVuZChjb21tZW50SXRlbSkKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g57yW6L6R5Zmo5YaF5LiN5a2Y5Zyo5a+55bqU5oiQ57uEaWTliJlkb23liJnnp7vpmaQKICAgICAgICAgICAgaWYgKGFjdGl2ZUNvbW1lbnREb20pIHsKICAgICAgICAgICAgICBhY3RpdmVDb21tZW50RG9tLnJlbW92ZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIC8vICAgLy8gIOebtOaOpeS4i+i9vVBERgogICAgLy8gICBjb25zdCBjYW52YXNUb1BkZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KCcuY2FudmFzMnBkZicpIQogICAgLy8gICBjYW52YXNUb1BkZi5vbmNsaWNrID0gZnVuY3Rpb24oKXsKICAgIC8vICAgICAvLyDojrflj5ZDYW52YXPlhYPntKAKICAgIC8vIHZhciBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxEaXZFbGVtZW50PignI2NhbnZhcyBjYW52YXMnKTsKCiAgICAvLyAvLyDliJvlu7rkuIDkuKrmlrDnmoRqc1BERuWunuS+iwogICAgLy8gdmFyIHBkZiA9IG5ldyBqc1BERigpOwoKICAgIC8vIC8vIOWwhkNhbnZhc+i9rOaNouS4uuWbvuWDj+aVsOaNrlVSTAogICAgLy8gdmFyIGNhbnZhc0RhdGFVUkwgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMS4wKTsKCiAgICAvLyAvLyDlsIblm77lg4/mlbDmja5VUkzmt7vliqDliLBQREbkuK0KICAgIC8vIHBkZi5hZGRJbWFnZShjYW52YXNEYXRhVVJMLCAnSlBFRycsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgLy8gLy8g5L+d5a2YUERG5paH5Lu2CiAgICAvLyBwZGYuc2F2ZSgnY2FudmFzLnBkZicpOwogICAgLy8gICB9CiAgICAvLyA4LiDlhoXpg6jkuovku7bnm5HlkKwKICAgIGluc3RhbmNlLmxpc3RlbmVyLnJhbmdlU3R5bGVDaGFuZ2UgPSBmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAvLyDmjqfku7bnsbvlnosKICAgICAgcGF5bG9hZC50eXBlID09PSBFbGVtZW50VHlwZS5TVUJTQ1JJUFQgPwogICAgICAgIHN1YnNjcmlwdERvbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKSA6CiAgICAgICAgc3Vic2NyaXB0RG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgIHBheWxvYWQudHlwZSA9PT0gRWxlbWVudFR5cGUuU1VQRVJTQ1JJUFQgPwogICAgICAgIHN1cGVyc2NyaXB0RG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpIDoKICAgICAgICBzdXBlcnNjcmlwdERvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICBwYXlsb2FkLnR5cGUgPT09IEVsZW1lbnRUeXBlLlNFUEFSQVRPUiA/CiAgICAgICAgc2VwYXJhdG9yRG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpIDoKICAgICAgICBzZXBhcmF0b3JEb20uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKICAgICAgc2VwYXJhdG9yT3B0aW9uRG9tCiAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykKICAgICAgICAuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgaWYgKHBheWxvYWQudHlwZSA9PT0gRWxlbWVudFR5cGUuU0VQQVJBVE9SKSB7CiAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gcGF5bG9hZC5kYXNoQXJyYXkuam9pbignLCcpIHx8ICcwLDAnCiAgICAgICAgY29uc3QgY3VyU2VwYXJhdG9yRG9tID0gc2VwYXJhdG9yT3B0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MTElFbGVtZW50ID4gKAogICAgICAgICAgICBgW2RhdGEtc2VwYXJhdG9yPScke3NlcGFyYXRvcn0nXWAKICAgICAgICAgICkgIQogICAgICAgICAgaWYgKGN1clNlcGFyYXRvckRvbSkgewogICAgICAgICAgICBjdXJTZXBhcmF0b3JEb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5a+M5paH5pysCiAgICAgIGZvbnRPcHRpb25Eb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCA8IEhUTUxMSUVsZW1lbnQgPiAoJ2xpJykKICAgICAgICAuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgY29uc3QgY3VyRm9udERvbSA9IGZvbnRPcHRpb25Eb20ucXVlcnlTZWxlY3RvciA8IEhUTUxMSUVsZW1lbnQgPiAoCiAgICAgICAgYFtkYXRhLWZhbWlseT0nJHtwYXlsb2FkLmZvbnR9J11gCiAgICAgICkKICAgICAgaWYgKGN1ckZvbnREb20pIHsKICAgICAgICBmb250U2VsZWN0RG9tLmlubmVyVGV4dCA9IGN1ckZvbnREb20uaW5uZXJUZXh0CiAgICAgICAgZm9udFNlbGVjdERvbS5zdHlsZS5mb250RmFtaWx5ID0gcGF5bG9hZC5mb250CiAgICAgICAgY3VyRm9udERvbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQogICAgICB9CiAgICAgIHNpemVPcHRpb25Eb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCA8IEhUTUxMSUVsZW1lbnQgPiAoJ2xpJykKICAgICAgICAuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgY29uc3QgY3VyU2l6ZURvbSA9IHNpemVPcHRpb25Eb20ucXVlcnlTZWxlY3RvciA8IEhUTUxMSUVsZW1lbnQgPiAoCiAgICAgICAgYFtkYXRhLXNpemU9JyR7cGF5bG9hZC5zaXplfSddYAogICAgICApCiAgICAgIGlmIChjdXJTaXplRG9tKSB7CiAgICAgICAgc2l6ZVNlbGVjdERvbS5pbm5lclRleHQgPSBjdXJTaXplRG9tLmlubmVyVGV4dAogICAgICAgIGN1clNpemVEb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgfSBlbHNlIHsKICAgICAgICBzaXplU2VsZWN0RG9tLmlubmVyVGV4dCA9IGAke3BheWxvYWQuc2l6ZX1gCiAgICAgIH0KICAgICAgcGF5bG9hZC5ib2xkID8KICAgICAgICBib2xkRG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpIDoKICAgICAgICBib2xkRG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgIHBheWxvYWQuaXRhbGljID8KICAgICAgICBpdGFsaWNEb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykgOgogICAgICAgIGl0YWxpY0RvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICBwYXlsb2FkLnVuZGVybGluZSA/CiAgICAgICAgdW5kZXJsaW5lRG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpIDoKICAgICAgICB1bmRlcmxpbmVEb20uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKICAgICAgcGF5bG9hZC5zdHJpa2VvdXQgPwogICAgICAgIHN0cmlrZW91dERvbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKSA6CiAgICAgICAgc3RyaWtlb3V0RG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgIGlmIChwYXlsb2FkLmNvbG9yKSB7CiAgICAgICAgY29sb3JEb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgICBjb2xvckNvbnRyb2xEb20udmFsdWUgPSBwYXlsb2FkLmNvbG9yCiAgICAgICAgY29sb3JTcGFuRG9tLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHBheWxvYWQuY29sb3IKICAgICAgfSBlbHNlIHsKICAgICAgICBjb2xvckRvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICAgIGNvbG9yQ29udHJvbERvbS52YWx1ZSA9ICcjMDAwMDAwJwogICAgICAgIGNvbG9yU3BhbkRvbS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnIzAwMDAwMCcKICAgICAgfQogICAgICBpZiAocGF5bG9hZC5oaWdobGlnaHQpIHsKICAgICAgICBoaWdobGlnaHREb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgICBoaWdobGlnaHRDb250cm9sRG9tLnZhbHVlID0gcGF5bG9hZC5oaWdobGlnaHQKICAgICAgICBoaWdobGlnaHRTcGFuRG9tLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IHBheWxvYWQuaGlnaGxpZ2h0CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGlnaGxpZ2h0RG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgICAgaGlnaGxpZ2h0Q29udHJvbERvbS52YWx1ZSA9ICcjZmZmZjAwJwogICAgICAgIGhpZ2hsaWdodFNwYW5Eb20uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZmZmMDAnCiAgICAgIH0KCiAgICAgIC8vIOihjOW4g+WxgAogICAgICBsZWZ0RG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgIGNlbnRlckRvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICByaWdodERvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICBhbGlnbm1lbnREb20uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykKICAgICAgaWYgKHBheWxvYWQucm93RmxleCAmJiBwYXlsb2FkLnJvd0ZsZXggPT09ICdyaWdodCcpIHsKICAgICAgICByaWdodERvbS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQogICAgICB9IGVsc2UgaWYgKHBheWxvYWQucm93RmxleCAmJiBwYXlsb2FkLnJvd0ZsZXggPT09ICdjZW50ZXInKSB7CiAgICAgICAgY2VudGVyRG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpCiAgICAgIH0gZWxzZSBpZiAocGF5bG9hZC5yb3dGbGV4ICYmIHBheWxvYWQucm93RmxleCA9PT0gJ2FsaWdubWVudCcpIHsKICAgICAgICBhbGlnbm1lbnREb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgfSBlbHNlIHsKICAgICAgICBsZWZ0RG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpCiAgICAgIH0KCiAgICAgIC8vIOihjOmXtOi3nQogICAgICByb3dPcHRpb25Eb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCA8IEhUTUxMSUVsZW1lbnQgPiAoJ2xpJykKICAgICAgICAuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgY29uc3QgY3VyUm93TWFyZ2luRG9tID0gcm93T3B0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MTElFbGVtZW50ID4gKAogICAgICAgICAgYFtkYXRhLXJvd21hcmdpbj0nJHtwYXlsb2FkLnJvd01hcmdpbn0nXWAKICAgICAgICApICEKICAgICAgICBjdXJSb3dNYXJnaW5Eb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKCiAgICAgIC8vIOWKn+iDvQogICAgICBwYXlsb2FkLnVuZG8gPwogICAgICAgIHVuZG9Eb20uY2xhc3NMaXN0LnJlbW92ZSgnbm8tYWxsb3cnKSA6CiAgICAgICAgdW5kb0RvbS5jbGFzc0xpc3QuYWRkKCduby1hbGxvdycpCiAgICAgIHBheWxvYWQucmVkbyA/CiAgICAgICAgcmVkb0RvbS5jbGFzc0xpc3QucmVtb3ZlKCduby1hbGxvdycpIDoKICAgICAgICByZWRvRG9tLmNsYXNzTGlzdC5hZGQoJ25vLWFsbG93JykKICAgICAgcGF5bG9hZC5wYWludGVyID8KICAgICAgICBwYWludGVyRG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpIDoKICAgICAgICBwYWludGVyRG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCgogICAgICAvLyDmoIfpopgKICAgICAgdGl0bGVPcHRpb25Eb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCA8IEhUTUxMSUVsZW1lbnQgPiAoJ2xpJykKICAgICAgICAuZm9yRWFjaChsaSA9PiBsaS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSkKICAgICAgaWYgKHBheWxvYWQubGV2ZWwpIHsKICAgICAgICBjb25zdCBjdXJUaXRsZURvbSA9IHRpdGxlT3B0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MTElFbGVtZW50ID4gKAogICAgICAgICAgICBgW2RhdGEtbGV2ZWw9JyR7cGF5bG9hZC5sZXZlbH0nXWAKICAgICAgICAgICkgIQogICAgICAgICAgdGl0bGVTZWxlY3REb20uaW5uZXJUZXh0ID0gY3VyVGl0bGVEb20uaW5uZXJUZXh0CiAgICAgICAgY3VyVGl0bGVEb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgfSBlbHNlIHsKICAgICAgICB0aXRsZVNlbGVjdERvbS5pbm5lclRleHQgPSAn5q2j5paHJwogICAgICAgIHRpdGxlT3B0aW9uRG9tLnF1ZXJ5U2VsZWN0b3IoJ2xpOmZpcnN0LWNoaWxkJykgIS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKQogICAgICB9CgogICAgICAvLyDliJfooagKICAgICAgbGlzdE9wdGlvbkRvbQogICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsIDwgSFRNTExJRWxlbWVudCA+ICgnbGknKQogICAgICAgIC5mb3JFYWNoKGxpID0+IGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKQogICAgICBpZiAocGF5bG9hZC5saXN0VHlwZSkgewogICAgICAgIGxpc3REb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgICBjb25zdCBsaXN0VHlwZSA9IHBheWxvYWQubGlzdFR5cGUKICAgICAgICBjb25zdCBsaXN0U3R5bGUgPQogICAgICAgICAgcGF5bG9hZC5saXN0VHlwZSA9PT0gTGlzdFR5cGUuT0wgPyBMaXN0U3R5bGUuREVDSU1BTCA6IHBheWxvYWQubGlzdFR5cGUKICAgICAgICBjb25zdCBjdXJMaXN0RG9tID0gbGlzdE9wdGlvbkRvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTExJRWxlbWVudCA+ICgKICAgICAgICAgIGBbZGF0YS1saXN0LXR5cGU9JyR7bGlzdFR5cGV9J11bZGF0YS1saXN0LXN0eWxlPScke2xpc3RTdHlsZX0nXWAKICAgICAgICApCiAgICAgICAgaWYgKGN1ckxpc3REb20pIHsKICAgICAgICAgIGN1ckxpc3REb20uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJykKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGlzdERvbS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKQogICAgICB9CgogICAgICAvLyDmibnms6gKICAgICAgY29tbWVudERvbQogICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsIDwgSFRNTERpdkVsZW1lbnQgPiAoJy5jb21tZW50LWl0ZW0nKQogICAgICAgIC5mb3JFYWNoKGNvbW1lbnRJdGVtRG9tID0+IHsKICAgICAgICAgIGNvbW1lbnRJdGVtRG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpCiAgICAgICAgfSkKICAgICAgaWYgKHBheWxvYWQuZ3JvdXBJZHMpIHsKICAgICAgICBjb25zdCBbaWRdID0gcGF5bG9hZC5ncm91cElkcwogICAgICAgIGNvbnN0IGFjdGl2ZUNvbW1lbnREb20gPSBjb21tZW50RG9tLnF1ZXJ5U2VsZWN0b3IgPCBIVE1MRGl2RWxlbWVudCA+ICgKICAgICAgICAgIGAuY29tbWVudC1pdGVtW2RhdGEtaWQ9JyR7aWR9J11gCiAgICAgICAgKQogICAgICAgIGlmIChhY3RpdmVDb21tZW50RG9tKSB7CiAgICAgICAgICBhY3RpdmVDb21tZW50RG9tLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpCiAgICAgICAgICBzY3JvbGxJbnRvVmlldyhjb21tZW50RG9tLCBhY3RpdmVDb21tZW50RG9tKQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGluc3RhbmNlLmxpc3RlbmVyLnZpc2libGVQYWdlTm9MaXN0Q2hhbmdlID0gZnVuY3Rpb24gKHBheWxvYWQpIHsKICAgICAgY29uc3QgdGV4dCA9IHBheWxvYWQubWFwKGkgPT4gaSArIDEpLmpvaW4oJ+OAgScpCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MU3BhbkVsZW1lbnQgPiAoJy5wYWdlLW5vLWxpc3QnKSAhLmlubmVyVGV4dCA9IHRleHQKICAgIH0KCiAgICBpbnN0YW5jZS5saXN0ZW5lci5wYWdlU2l6ZUNoYW5nZSA9IGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MU3BhbkVsZW1lbnQgPiAoCiAgICAgICAgJy5wYWdlLXNpemUnCiAgICAgICkgIS5pbm5lclRleHQgPSBgJHtwYXlsb2FkfWAKICAgIH0KCiAgICBpbnN0YW5jZS5saXN0ZW5lci5pbnRlcnNlY3Rpb25QYWdlTm9DaGFuZ2UgPSBmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yIDwgSFRNTFNwYW5FbGVtZW50ID4gKCcucGFnZS1ubycpICEuaW5uZXJUZXh0ID0gYCR7cGF5bG9hZCArIDEKICAgIH1gCiAgICB9CgogICAgaW5zdGFuY2UubGlzdGVuZXIucGFnZVNjYWxlQ2hhbmdlID0gZnVuY3Rpb24gKHBheWxvYWQpIHsKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxTcGFuRWxlbWVudCA+ICgKICAgICAgICAnLnBhZ2Utc2NhbGUtcGVyY2VudGFnZScKICAgICAgKSAhLmlubmVyVGV4dCA9IGAke01hdGguZmxvb3IocGF5bG9hZCAqIDEwICogMTApfSVgCiAgICB9CgogICAgaW5zdGFuY2UubGlzdGVuZXIuY29udHJvbENoYW5nZSA9IGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgIGNvbnN0IGRpc2FibGVNZW51c0luQ29udHJvbENvbnRleHQgPSBbCiAgICAgICAgJ3N1cGVyc2NyaXB0JywKICAgICAgICAnc3Vic2NyaXB0JywKICAgICAgICAndGFibGUnLAogICAgICAgICdpbWFnZScsCiAgICAgICAgJ2h5cGVybGluaycsCiAgICAgICAgJ3NlcGFyYXRvcicsCiAgICAgICAgJ2NvZGVibG9jaycsCiAgICAgICAgJ3BhZ2UtYnJlYWsnLAogICAgICAgICdjb250cm9sJywKICAgICAgICAnY2hlY2tib3gnCiAgICAgIF0KICAgICAgLy8g6I+c5Y2V5pON5L2c5p2D6ZmQCiAgICAgIGRpc2FibGVNZW51c0luQ29udHJvbENvbnRleHQuZm9yRWFjaChtZW51ID0+IHsKICAgICAgICBjb25zdCBtZW51RG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciA8IEhUTUxEaXZFbGVtZW50ID4gKAogICAgICAgICAgICBgLm1lbnUtaXRlbV9fJHttZW51fWAKICAgICAgICAgICkgIQogICAgICAgICAgcGF5bG9hZCA/CiAgICAgICAgICBtZW51RG9tLmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGUnKSA6CiAgICAgICAgICBtZW51RG9tLmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGUnKQogICAgICB9KQogICAgfQoKICAgIGluc3RhbmNlLmxpc3RlbmVyLnBhZ2VNb2RlQ2hhbmdlID0gZnVuY3Rpb24gKHBheWxvYWQpIHsKICAgICAgY29uc3QgYWN0aXZlTW9kZSA9IHBhZ2VNb2RlT3B0aW9uc0RvbS5xdWVyeVNlbGVjdG9yIDwgSFRNTExJRWxlbWVudCA+ICgKICAgICAgICAgIGBbZGF0YS1wYWdlLW1vZGU9JyR7cGF5bG9hZH0nXWAKICAgICAgICApICEKICAgICAgICBwYWdlTW9kZU9wdGlvbnNEb20KICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnbGknKQogICAgICAgIC5mb3JFYWNoKGxpID0+IGxpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKQogICAgICBhY3RpdmVNb2RlLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpCiAgICB9CgogICAgY29uc3QgaGFuZGxlQ29udGVudENoYW5nZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgLy8g5a2X5pWwCiAgICAgIGNvbnN0IHdvcmRDb3VudCA9IGF3YWl0IGluc3RhbmNlLmNvbW1hbmQuZ2V0V29yZENvdW50KCkKICAgICAgY29uc29sZS5sb2coaW5zdGFuY2UpCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgPCBIVE1MU3BhbkVsZW1lbnQgPiAoJy53b3JkLWNvdW50JykgIS5pbm5lclRleHQgPSBgJHt3b3JkQ291bnQgfHwgMAogICAgfWAKICAgICAgLy8g55uu5b2VCiAgICAgIGlmIChpc0NhdGFsb2dTaG93KSB7CiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdXBkYXRlQ2F0YWxvZygpCiAgICAgICAgfSkKICAgICAgfQogICAgICAvLyDmibnms6gKICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgIHVwZGF0ZUNvbW1lbnQoKQogICAgICB9KQogICAgfQogICAgaW5zdGFuY2UubGlzdGVuZXIuY29udGVudENoYW5nZSA9IGRlYm91bmNlKGhhbmRsZUNvbnRlbnRDaGFuZ2UsIDIwMCkKICAgIGhhbmRsZUNvbnRlbnRDaGFuZ2UoKQoKICAgIGluc3RhbmNlLmxpc3RlbmVyLnNhdmVkID0gZnVuY3Rpb24gKHBheWxvYWQpIHsKICAgICAgY29uc29sZS5sb2coJ2VsZW1lbnRMaXN0OiAnLCBwYXlsb2FkKQogICAgfQoKICAgIC8vIDkuIOWPs+mUruiPnOWNleazqOWGjAogICAgaW5zdGFuY2UucmVnaXN0ZXIuY29udGV4dE1lbnVMaXN0KFt7CiAgICAgICAgbmFtZTogJ+aJueazqCcsCiAgICAgICAgd2hlbjogcGF5bG9hZCA9PiB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAhcGF5bG9hZC5pc1JlYWRvbmx5ICYmCiAgICAgICAgICAgIHBheWxvYWQuZWRpdG9ySGFzU2VsZWN0aW9uICYmCiAgICAgICAgICAgIHBheWxvYWQuem9uZSA9PT0gRWRpdG9yWm9uZS5NQUlOCiAgICAgICAgICApCiAgICAgICAgfSwKICAgICAgICBjYWxsYmFjazogKGNvbW1hbmQ6IENvbW1hbmQpID0+IHsKICAgICAgICAgIG5ldyBEaWFsb2coewogICAgICAgICAgICB0aXRsZTogJ+aJueazqCcsCiAgICAgICAgICAgIGRhdGE6IFt7CiAgICAgICAgICAgICAgdHlwZTogJ3RleHRhcmVhJywKICAgICAgICAgICAgICBsYWJlbDogJ+aJueazqCcsCiAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAsCiAgICAgICAgICAgICAgbmFtZTogJ3ZhbHVlJywKICAgICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJ+ivt+i+k+WFpeaJueazqCcKICAgICAgICAgICAgfV0sCiAgICAgICAgICAgIG9uQ29uZmlybTogcGF5bG9hZCA9PiB7CiAgICAgICAgICAgICAgbGV0IHZhbHVlMSA9IHBheWxvYWQuZmluZChwID0+IHAubmFtZSA9PT0gJ3ZhbHVlJykKCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAhIXZhbHVlMSA/IHZhbHVlMS52YWx1ZSA6ICcnCiAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuCiAgICAgICAgICAgICAgY29uc3QgZ3JvdXBJZCA9IGNvbW1hbmQuZXhlY3V0ZVNldEdyb3VwKCkKICAgICAgICAgICAgICBpZiAoIWdyb3VwSWQpIHJldHVybgogICAgICAgICAgICAgIGNvbW1lbnRMaXN0LnB1c2goewogICAgICAgICAgICAgICAgaWQ6IGdyb3VwSWQsCiAgICAgICAgICAgICAgICBjb250ZW50OiB2YWx1ZSwKICAgICAgICAgICAgICAgIHVzZXJOYW1lOiAnSHVmZScsCiAgICAgICAgICAgICAgICByYW5nZVRleHQ6IGNvbW1hbmQuZ2V0UmFuZ2VUZXh0KCksCiAgICAgICAgICAgICAgICBjcmVhdGVkRGF0ZTogbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHsKICAgICAgICBuYW1lOiAn562+5ZCNJywKICAgICAgICBpY29uOiAnc2lnbmF0dXJlJywKICAgICAgICB3aGVuOiBwYXlsb2FkID0+IHsKICAgICAgICAgIHJldHVybiAhcGF5bG9hZC5pc1JlYWRvbmx5ICYmIHBheWxvYWQuZWRpdG9yVGV4dEZvY3VzCiAgICAgICAgfSwKICAgICAgICBjYWxsYmFjazogKGNvbW1hbmQ6IENvbW1hbmQpID0+IHsKICAgICAgICAgIG5ldyBTaWduYXR1cmUoewogICAgICAgICAgICBvbkNvbmZpcm0ocGF5bG9hZCkgewogICAgICAgICAgICAgIGlmICghcGF5bG9hZCkgcmV0dXJuCiAgICAgICAgICAgICAgY29uc3QgewogICAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgICB3aWR0aCwKICAgICAgICAgICAgICAgIGhlaWdodAogICAgICAgICAgICAgIH0gPSBwYXlsb2FkCiAgICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCAhd2lkdGggfHwgIWhlaWdodCkgcmV0dXJuCiAgICAgICAgICAgICAgY29tbWFuZC5leGVjdXRlSW5zZXJ0RWxlbWVudExpc3QoW3sKICAgICAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQsCiAgICAgICAgICAgICAgICB0eXBlOiBFbGVtZW50VHlwZS5JTUFHRQogICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgIG5hbWU6ICfmoLzlvI/mlbTnkIYnLAogICAgICAgIGljb246ICd3b3JkLXRvb2wnLAogICAgICAgIHdoZW46IHBheWxvYWQgPT4gewogICAgICAgICAgcmV0dXJuICFwYXlsb2FkLmlzUmVhZG9ubHkKICAgICAgICB9LAogICAgICAgIGNhbGxiYWNrOiAoY29tbWFuZDogQ29tbWFuZCkgPT4gewogICAgICAgICAgY29tbWFuZC5leGVjdXRlV29yZFRvb2woKQogICAgICAgIH0KICAgICAgfQogICAgXSkKCiAgICAvLyAxMC4g5b+r5o236ZSu5rOo5YaMCiAgICBpbnN0YW5jZS5yZWdpc3Rlci5zaG9ydGN1dExpc3QoW3sKICAgICAgICBrZXk6IEtleU1hcC5QLAogICAgICAgIG1vZDogdHJ1ZSwKICAgICAgICBpc0dsb2JhbDogdHJ1ZSwKICAgICAgICBjYWxsYmFjazogKGNvbW1hbmQ6IENvbW1hbmQpID0+IHsKICAgICAgICAgIGNvbW1hbmQuZXhlY3V0ZVByaW50KCkKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHsKICAgICAgICBrZXk6IEtleU1hcC5GLAogICAgICAgIG1vZDogdHJ1ZSwKICAgICAgICBpc0dsb2JhbDogdHJ1ZSwKICAgICAgICBjYWxsYmFjazogKGNvbW1hbmQ6IENvbW1hbmQpID0+IHsKICAgICAgICAgIGNvbnN0IHRleHQgPSBjb21tYW5kLmdldFJhbmdlVGV4dCgpCiAgICAgICAgICBzZWFyY2hEb20uY2xpY2soKQogICAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgICAgc2VhcmNoSW5wdXREb20udmFsdWUgPSB0ZXh0CiAgICAgICAgICAgIGluc3RhbmNlLmNvbW1hbmQuZXhlY3V0ZVNlYXJjaCh0ZXh0KQogICAgICAgICAgICBzZXRTZWFyY2hSZXN1bHQoKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgewogICAgICAgIGtleTogS2V5TWFwLk1JTlVTLAogICAgICAgIGN0cmw6IHRydWUsCiAgICAgICAgaXNHbG9iYWw6IHRydWUsCiAgICAgICAgY2FsbGJhY2s6IChjb21tYW5kOiBDb21tYW5kKSA9PiB7CiAgICAgICAgICBjb21tYW5kLmV4ZWN1dGVQYWdlU2NhbGVNaW51cygpCiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAga2V5OiBLZXlNYXAuRVFVQUwsCiAgICAgICAgY3RybDogdHJ1ZSwKICAgICAgICBpc0dsb2JhbDogdHJ1ZSwKICAgICAgICBjYWxsYmFjazogKGNvbW1hbmQ6IENvbW1hbmQpID0+IHsKICAgICAgICAgIGNvbW1hbmQuZXhlY3V0ZVBhZ2VTY2FsZUFkZCgpCiAgICAgICAgfQogICAgICB9LAogICAgICB7CiAgICAgICAga2V5OiBLZXlNYXAuWkVSTywKICAgICAgICBjdHJsOiB0cnVlLAogICAgICAgIGlzR2xvYmFsOiB0cnVlLAogICAgICAgIGNhbGxiYWNrOiAoY29tbWFuZDogQ29tbWFuZCkgPT4gewogICAgICAgICAgY29tbWFuZC5leGVjdXRlUGFnZVNjYWxlUmVjb3ZlcnkoKQogICAgICAgIH0KICAgICAgfQogICAgXSkKICB9LAogIG1ldGhvZHM6IHsKICAgIHNldEh0bWwodmFsOiBhbnkpIHsKICAgICAgY29uc29sZS5sb2codmFsKQogICAgICBpbnN0YW5jZUV4cG9ydC5jb21tYW5kLmV4ZWN1dGVJbnNlcnRFbGVtZW50TGlzdCh2YWwpCiAgICB9CiAgfQp9KQo="},{"version":3,"sources":["Index1.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Index1.vue","sourceRoot":"src/components/CanvasEdit","sourcesContent":["<template>\n  <div class=\"editbox\">\n    <div class=\"menu\" editor-component=\"menu\">\n      <!-- <div class=\"menu-item\"> -->\n\n      <!-- </div> -->\n      <!-- <div class=\"menu-divider\"></div> -->\n      <div class=\"menu-item\">\n        <div class=\"menu-item__undo\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__redo\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__painter\" title=\"格式刷(双击可连续使用)\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__format\" title=\"清除格式\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__font\">\n          <span class=\"select\" title=\"字体\">微软雅黑</span>\n          <div class=\"options\">\n            <ul>\n              <li data-family=\"Yahei\" style=\"font-family:'Yahei';\">微软雅黑</li>\n              <li data-family=\"宋体\" style=\"font-family:'宋体';\">宋体</li>\n              <li data-family=\"黑体\" style=\"font-family:'黑体';\">黑体</li>\n              <li data-family=\"仿宋\" style=\"font-family:'仿宋';\">仿宋</li>\n              <li data-family=\"楷体\" style=\"font-family:'楷体';\">楷体</li>\n              <li data-family=\"等线\" style=\"font-family:'等线';\">等线</li>\n              <li data-family=\"华文琥珀\" style=\"font-family:'华文琥珀';\">华文琥珀</li>\n              <li data-family=\"华文楷体\" style=\"font-family:'华文楷体';\">华文楷体</li>\n              <li data-family=\"华文隶书\" style=\"font-family:'华文隶书';\">华文隶书</li>\n              <li data-family=\"华文新魏\" style=\"font-family:'华文新魏';\">华文新魏</li>\n              <li data-family=\"华文行楷\" style=\"font-family:'华文行楷';\">华文行楷</li>\n              <li data-family=\"华文中宋\" style=\"font-family:'华文中宋';\">华文中宋</li>\n              <li data-family=\"华文彩云\" style=\"font-family:'华文彩云';\">华文彩云</li>\n              <li data-family=\"Arial\" style=\"font-family:'Arial';\">Arial</li>\n              <li data-family=\"Segoe UI\" style=\"font-family:'Segoe UI';\">Segoe UI</li>\n              <li data-family=\"Ink Free\" style=\"font-family:'Ink Free';\">Ink Free</li>\n              <li data-family=\"Fantasy\" style=\"font-family:'Fantasy';\">Fantasy</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__size\">\n          <span class=\"select\" title=\"字体\">小四</span>\n          <div class=\"options\">\n            <ul>\n              <li data-size=\"56\">初号</li>\n              <li data-size=\"48\">小初</li>\n              <li data-size=\"34\">一号</li>\n              <li data-size=\"32\">小一</li>\n              <li data-size=\"29\">二号</li>\n              <li data-size=\"24\">小二</li>\n              <li data-size=\"21\">三号</li>\n              <li data-size=\"20\">小三</li>\n              <li data-size=\"18\">四号</li>\n              <li data-size=\"16\">小四</li>\n              <li data-size=\"14\">五号</li>\n              <li data-size=\"12\">小五</li>\n              <li data-size=\"10\">六号</li>\n              <li data-size=\"8\">小六</li>\n              <li data-size=\"7\">七号</li>\n              <li data-size=\"6\">八号</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__size-add\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__size-minus\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__bold\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__italic\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__underline\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__strikeout\" title=\"删除线(Ctrl+Shift+X)\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__superscript\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__subscript\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__color\" title=\"字体颜色\">\n          <i></i>\n          <span></span>\n          <input type=\"color\" id=\"color\" />\n        </div>\n        <div class=\"menu-item__highlight\" title=\"高亮\">\n          <i></i>\n          <span></span>\n          <input type=\"color\" id=\"highlight\">\n        </div>\n        <div class=\"menu-item__search\" data-menu=\"search\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__search__collapse\" data-menu=\"search\">\n          <div class=\"menu-item__search__collapse__search\">\n            <input type=\"text\" />\n            <label class=\"search-result\"></label>\n            <div class=\"arrow-left\">\n              <i></i>\n            </div>\n            <div class=\"arrow-right\">\n              <i></i>\n            </div>\n            <span>×</span>\n          </div>\n          <div class=\"menu-item__search__collapse__replace\">\n            <input type=\"text\">\n            <button>替换</button>\n          </div>\n        </div>\n        <div class=\"menu-item__print\" data-menu=\"print\">\n          <i></i>\n        </div>\n      </div>\n      <!-- <div class=\"menu-divider\"></div> -->\n      <div class=\"menu-item\">\n        <div class=\"menu-item__title\">\n          <i></i>\n          <span class=\"select\" title=\"切换标题\">正文</span>\n          <div class=\"options\">\n            <ul>\n              <li style=\"font-size:16px;\">正文</li>\n              <li data-level=\"first\" style=\"font-size:26px;\">标题1</li>\n              <li data-level=\"second\" style=\"font-size:24px;\">标题2</li>\n              <li data-level=\"third\" style=\"font-size:22px;\">标题3</li>\n              <li data-level=\"fourth\" style=\"font-size:20px;\">标题4</li>\n              <li data-level=\"fifth\" style=\"font-size:18px;\">标题5</li>\n              <li data-level=\"sixth\" style=\"font-size:16px;\">标题6</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__left\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__center\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__right\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__alignment\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__row-margin\">\n          <i title=\"行间距\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-rowmargin='1'>1</li>\n              <li data-rowmargin=\"1.25\">1.25</li>\n              <li data-rowmargin=\"1.5\">1.5</li>\n              <li data-rowmargin=\"1.75\">1.75</li>\n              <li data-rowmargin=\"2\">2</li>\n              <li data-rowmargin=\"2.5\">2.5</li>\n              <li data-rowmargin=\"3\">3</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__list\">\n          <i></i>\n          <div class=\"options\">\n            <ul>\n              <li>\n                <label>取消列表</label>\n              </li>\n              <li data-list-type=\"ol\" data-list-style='decimal'>\n                <label>有序列表：</label>\n                <ol>\n                  <li>________</li>\n                </ol>\n              </li>\n              <li data-list-type=\"ul\" data-list-style='disc'>\n                <label>实心圆点列表：</label>\n                <ul style=\"list-style-type: disc;\">\n                  <li>________</li>\n                </ul>\n              </li>\n              <li data-list-type=\"ul\" data-list-style='circle'>\n                <label>空心圆点列表：</label>\n                <ul style=\"list-style-type: circle;\">\n                  <li>________</li>\n                </ul>\n              </li>\n              <li data-list-type=\"ul\" data-list-style='square'>\n                <label>空心方块列表：</label>\n                <ul style=\"list-style-type: square;\">\n                  <li>________</li>\n                </ul>\n              </li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__table\">\n          <i title=\"表格\"></i>\n        </div>\n        <div class=\"menu-item__table__collapse\">\n          <div class=\"table-close\">×</div>\n          <div class=\"table-title\">\n            <span class=\"table-select\">插入</span>\n            <span>表格</span>\n          </div>\n          <div class=\"table-panel\"></div>\n        </div>\n        <div class=\"menu-item__image\">\n          <i title=\"图片\"></i>\n          <input type=\"file\" id=\"image\" accept=\".png, .jpg, .jpeg, .svg, .gif\">\n        </div>\n        <div class=\"menu-item__hyperlink\">\n          <i title=\"超链接\"></i>\n        </div>\n        <div class=\"menu-item__separator\">\n          <i title=\"分割线\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-separator='0,0'>\n                <i></i>\n              </li>\n              <li data-separator=\"1,1\">\n                <i></i>\n              </li>\n              <li data-separator=\"3,1\">\n                <i></i>\n              </li>\n              <li data-separator=\"4,4\">\n                <i></i>\n              </li>\n              <li data-separator=\"7,3,3,3\">\n                <i></i>\n              </li>\n              <li data-separator=\"6,2,2,2,2,2\">\n                <i></i>\n              </li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__watermark\">\n          <i title=\"水印(添加、删除)\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-menu=\"add\">添加水印</li>\n              <li data-menu=\"delete\">删除水印</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__codeblock\" title=\"代码块\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__page-break\" title=\"分页符\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__control\">\n          <i title=\"控件\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-control='text'>文本</li>\n              <li data-control=\"select\">列举</li>\n              <li data-control=\"checkbox\">复选框</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__checkbox\" title=\"复选框\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__latex\" title=\"LateX\">\n          <i></i>\n        </div>\n        <div class=\"menu-item__date\">\n          <i title=\"日期\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-format=\"yyyy-MM-dd\"></li>\n              <li data-format=\"yyyy-MM-dd hh:mm:ss\"></li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"menu-item__block\" title=\"内容块\">\n          <i></i>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div :class=\"!!editId?'canvas'+editId + ' editor':'editor'\" id=\"canvas\"></div>\n    <div class=\"comment\" editor-component=\"comment\"></div>\n    <div class=\"footer\" editor-component=\"footer\">\n      <div>\n        <div class=\"catalog-mode\" title=\"目录\">\n          <i></i>\n        </div>\n        <div class=\"page-mode\">\n          <i title=\"页面模式(分页、连页)\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-page-mode=\"paging\" class=\"active\">分页</li>\n              <li data-page-mode=\"continuity\">连页</li>\n            </ul>\n          </div>\n        </div>\n        <span>可见页码：<span class=\"page-no-list\">1</span></span>\n        <span>页面：<span class=\"page-no\">1</span>/<span class=\"page-size\">1</span></span>\n        <span>字数：<span class=\"word-count\">0</span></span>\n      </div>\n      <div class=\"editor-mode\" title=\"编辑模式(编辑、清洁、只读、表单)\">编辑模式</div>\n      <div>\n        <div class=\"page-scale-minus\" title=\"缩小(Ctrl+-)\">\n          <i></i>\n        </div>\n        <span class=\"page-scale-percentage\" title=\"显示比例(点击可复原Ctrl+0)\">100%</span>\n        <div class=\"page-scale-add\" title=\"放大(Ctrl+=)\">\n          <i></i>\n        </div>\n        <div class=\"paper-size\">\n          <i title=\"纸张类型\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-paper-size=\"794*1123\" class=\"active\">A4</li>\n              <li data-paper-size=\"1593*2251\">A2</li>\n              <li data-paper-size=\"1125*1593\">A3</li>\n              <li data-paper-size=\"565*796\">A5</li>\n              <li data-paper-size=\"412*488\">5号信封</li>\n              <li data-paper-size=\"450*866\">6号信封</li>\n              <li data-paper-size=\"609*862\">7号信封</li>\n              <li data-paper-size=\"862*1221\">9号信封</li>\n              <li data-paper-size=\"813*1266\">法律用纸</li>\n              <li data-paper-size=\"813*1054\">信纸</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"paper-direction\">\n          <i title=\"纸张方向\"></i>\n          <div class=\"options\">\n            <ul>\n              <li data-paper-direction=\"vertical\" class=\"active\">纵向</li>\n              <li data-paper-direction=\"horizontal\">横向</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"paper-margin\" title=\"页边距\">\n          <i></i>\n        </div>\n        <div class=\"fullscreen\" title=\"全屏显示\">\n          <i></i>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</template>\n<script lang=\"ts\">\n  // import {\n  //   windowOnload,\n  //   containerExport,\n  //   recoveryTableFun,\n  //    instanceExport\n  // } from \"../CanvasEdit/main\"\n  import {\n    options\n  } from './mock'\n  interface IComment {\n    id: string\n    content: string\n    userName: string\n    rangeText: string\n    createdDate: string\n  }\n  let commentList: IComment[]\n  const elementList: IElement[] = []\n  export const data: IElement[] = elementList\n  import './style.css'\n  import prism from 'prismjs'\n  import Editor, {\n    BlockType,\n    Command,\n    ControlType,\n    EditorMode,\n    EditorZone,\n    ElementType,\n    IBlock,\n    ICatalogItem,\n    IElement,\n    KeyMap,\n    ListStyle,\n    ListType,\n    PageMode,\n    PaperDirection,\n    RowFlex,\n    TitleLevel\n  } from './editor'\n  import {\n    Dialog\n  } from './components/dialog/Dialog'\n  import {\n    formatPrismToken\n  } from './utils/prism'\n  import {\n    Signature\n  } from './components/signature/Signature'\n  import {\n    debounce,\n    nextTick,\n    scrollIntoView\n  } from './utils'\n  import {\n    formatElementList\n  } from './editor/utils/element'\n  let instanceExport: any;\n  let obj = {};\n  import Vue from 'vue';\n  export default Vue.extend({\n    components: {},\n    props: ['editId', 'content'],\n    data() {\n      return {\n        aa: ''\n      }\n    },\n    mounted() {\n      const isApple =\n        typeof navigator !== 'undefined' && /Mac OS X/.test(navigator.userAgent)\n\n      // 1. 初始化编辑器\n      const container = document.querySelector < HTMLDivElement > ('.canvas' + this.editId) !\n\n        const instance = new Editor(\n          container, {\n            header: [],\n            main: < IElement[] > data,\n            footer: []\n          },\n          options\n        )\n      this.$emit(\"saveInstance\", instance)\n      obj = {\n        bgId: this.editId,\n        instance: instance\n      }\n      instanceExport = instance\n      console.log('实例: ', instance)\n      // cypress使用\n      Reflect.set(window, 'editor', instance)\n\n      // 菜单弹窗销毁\n      window.addEventListener(\n        'click',\n        evt => {\n          const visibleDom = document.querySelector('.visible')\n          if (!visibleDom || visibleDom.contains( < Node > evt.target)) return\n          visibleDom.classList.remove('visible')\n        }, {\n          capture: true\n        }\n      )\n\n      // 2. | 撤销 | 重做 | 格式刷 | 清除格式 |\n      const undoDom = document.querySelector < HTMLDivElement > ('.menu-item__undo') !\n        undoDom.title = `撤销(${isApple ? '⌘' : 'Ctrl'}+Z)`\n      undoDom.onclick = function () {\n        console.log('undo')\n        instance.command.executeUndo()\n      }\n\n      const redoDom = document.querySelector < HTMLDivElement > ('.menu-item__redo') !\n        redoDom.title = `重做(${isApple ? '⌘' : 'Ctrl'}+Y)`\n      redoDom.onclick = function () {\n        console.log('redo')\n        instance.command.executeRedo()\n      }\n\n      const painterDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__painter'\n        ) !\n        painterDom.onclick = function () {\n          console.log('painter')\n          instance.command.executePainter({\n            isDblclick: false\n          })\n        }\n      painterDom.ondblclick = function () {\n        console.log('painter')\n        instance.command.executePainter({\n          isDblclick: true\n        })\n      }\n\n      document.querySelector < HTMLDivElement > ('.menu-item__format') !.onclick =\n        function () {\n          console.log('format')\n          instance.command.executeFormat()\n        }\n\n      // 3. | 字体 | 字体变大 | 字体变小 | 加粗 | 斜体 | 下划线 | 删除线 | 上标 | 下标 | 字体颜色 | 背景色 |\n      const fontDom = document.querySelector < HTMLDivElement > ('.menu-item__font') !\n        const fontSelectDom = fontDom.querySelector < HTMLDivElement > ('.select') !\n          const fontOptionDom = fontDom.querySelector < HTMLDivElement > ('.options') !\n            fontDom.onclick = function () {\n              console.log('font')\n              fontOptionDom.classList.toggle('visible')\n            }\n      fontOptionDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        instance.command.executeFont(li.dataset.family!)\n      }\n\n      const sizeSetDom = document.querySelector < HTMLDivElement > ('.menu-item__size') !\n        const sizeSelectDom = sizeSetDom.querySelector < HTMLDivElement > ('.select') !\n          const sizeOptionDom = sizeSetDom.querySelector < HTMLDivElement > ('.options') !\n            sizeSetDom.title = `设置字号`\n      sizeSetDom.onclick = function () {\n        console.log('size')\n        sizeOptionDom.classList.toggle('visible')\n      }\n      sizeOptionDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        instance.command.executeSize(Number(li.dataset.size!))\n      }\n\n      const sizeAddDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__size-add'\n        ) !\n        sizeAddDom.title = `增大字号(${isApple ? '⌘' : 'Ctrl'}+[)`\n      sizeAddDom.onclick = function () {\n        console.log('size-add')\n        instance.command.executeSizeAdd()\n      }\n\n      const sizeMinusDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__size-minus'\n        ) !\n        sizeMinusDom.title = `减小字号(${isApple ? '⌘' : 'Ctrl'}+])`\n      sizeMinusDom.onclick = function () {\n        console.log('size-minus')\n        instance.command.executeSizeMinus()\n      }\n\n      const boldDom = document.querySelector < HTMLDivElement > ('.menu-item__bold') !\n        boldDom.title = `加粗(${isApple ? '⌘' : 'Ctrl'}+B)`\n      boldDom.onclick = function () {\n        console.log('bold')\n        instance.command.executeBold()\n      }\n\n      const italicDom =\n        document.querySelector < HTMLDivElement > ('.menu-item__italic') !\n        italicDom.title = `斜体(${isApple ? '⌘' : 'Ctrl'}+I)`\n      italicDom.onclick = function () {\n        console.log('italic')\n        instance.command.executeItalic()\n      }\n\n      const underlineDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__underline'\n        ) !\n        underlineDom.title = `下划线(${isApple ? '⌘' : 'Ctrl'}+U)`\n      underlineDom.onclick = function () {\n        console.log('underline')\n        instance.command.executeUnderline()\n      }\n\n      const strikeoutDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__strikeout'\n        ) !\n        strikeoutDom.onclick = function () {\n          console.log('strikeout')\n          instance.command.executeStrikeout()\n        }\n\n      const superscriptDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__superscript'\n        ) !\n        superscriptDom.title = `上标(${isApple ? '⌘' : 'Ctrl'}+Shift+,)`\n      superscriptDom.onclick = function () {\n        console.log('superscript')\n        instance.command.executeSuperscript()\n      }\n\n      const subscriptDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__subscript'\n        ) !\n        subscriptDom.title = `下标(${isApple ? '⌘' : 'Ctrl'}+Shift+.)`\n      subscriptDom.onclick = function () {\n        console.log('subscript')\n        instance.command.executeSubscript()\n      }\n\n      const colorControlDom = document.querySelector < HTMLInputElement > ('#color') !\n        colorControlDom.oninput = function () {\n          instance.command.executeColor(colorControlDom.value)\n        }\n      const colorDom = document.querySelector < HTMLDivElement > ('.menu-item__color') !\n        const colorSpanDom = colorDom.querySelector('span') !\n          colorDom.onclick = function () {\n            console.log('color')\n            colorControlDom.click()\n          }\n\n      const highlightControlDom =\n        document.querySelector < HTMLInputElement > ('#highlight') !\n        highlightControlDom.oninput = function () {\n          instance.command.executeHighlight(highlightControlDom.value)\n        }\n      const highlightDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__highlight'\n        ) !\n        const highlightSpanDom = highlightDom.querySelector('span') !\n          highlightDom.onclick = function () {\n            console.log('highlight')\n            highlightControlDom.click()\n          }\n\n      const titleDom = document.querySelector < HTMLDivElement > ('.menu-item__title') !\n        const titleSelectDom = titleDom.querySelector < HTMLDivElement > ('.select') !\n          const titleOptionDom = titleDom.querySelector < HTMLDivElement > ('.options') !\n            titleOptionDom.querySelectorAll('li').forEach((li, index) => {\n              li.title = `Ctrl+${isApple ? 'Option' : 'Alt'}+${index}`\n            })\n\n      titleDom.onclick = function () {\n        console.log('title')\n        titleOptionDom.classList.toggle('visible')\n      }\n      titleOptionDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        const level = < TitleLevel > li.dataset.level\n        instance.command.executeTitle(level || null)\n      }\n\n      const leftDom = document.querySelector < HTMLDivElement > ('.menu-item__left') !\n        leftDom.title = `左对齐(${isApple ? '⌘' : 'Ctrl'}+L)`\n      leftDom.onclick = function () {\n        console.log('left')\n        instance.command.executeRowFlex(RowFlex.LEFT)\n      }\n\n      const centerDom =\n        document.querySelector < HTMLDivElement > ('.menu-item__center') !\n        centerDom.title = `居中对齐(${isApple ? '⌘' : 'Ctrl'}+E)`\n      centerDom.onclick = function () {\n        console.log('center')\n        instance.command.executeRowFlex(RowFlex.CENTER)\n      }\n\n      const rightDom = document.querySelector < HTMLDivElement > ('.menu-item__right') !\n        rightDom.title = `右对齐(${isApple ? '⌘' : 'Ctrl'}+R)`\n      rightDom.onclick = function () {\n        console.log('right')\n        instance.command.executeRowFlex(RowFlex.RIGHT)\n      }\n\n      const alignmentDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__alignment'\n        ) !\n        alignmentDom.title = `两端对齐(${isApple ? '⌘' : 'Ctrl'}+J)`\n      alignmentDom.onclick = function () {\n        console.log('alignment')\n        instance.command.executeRowFlex(RowFlex.ALIGNMENT)\n      }\n\n      const rowMarginDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__row-margin'\n        ) !\n        const rowOptionDom = rowMarginDom.querySelector < HTMLDivElement > ('.options') !\n          rowMarginDom.onclick = function () {\n            console.log('row-margin')\n            rowOptionDom.classList.toggle('visible')\n          }\n      rowOptionDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        instance.command.executeRowMargin(Number(li.dataset.rowmargin!))\n      }\n\n      const listDom = document.querySelector < HTMLDivElement > ('.menu-item__list') !\n        listDom.title = `列表(${isApple ? '⌘' : 'Ctrl'}+Shift+U)`\n      const listOptionDom = listDom.querySelector < HTMLDivElement > ('.options') !\n        listDom.onclick = function () {\n          console.log('list')\n          listOptionDom.classList.toggle('visible')\n        }\n      listOptionDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        const listType = < ListType > li.dataset.listType || null\n        const listStyle = < ListStyle > ( < unknown > li.dataset.listStyle)\n        instance.command.executeList(listType, listStyle)\n      }\n\n      // 4. | 表格 | 图片 | 超链接 | 分割线 | 水印 | 代码块 | 分隔符 | 控件 | 复选框 | LaTeX | 日期选择器\n      const tableDom = document.querySelector < HTMLDivElement > ('.menu-item__table') !\n        const tablePanelContainer = document.querySelector < HTMLDivElement > (\n            '.menu-item__table__collapse'\n          ) !\n          const tableClose = document.querySelector < HTMLDivElement > ('.table-close') !\n            const tableTitle = document.querySelector < HTMLDivElement > ('.table-select') !\n              const tablePanel = document.querySelector < HTMLDivElement > ('.table-panel') !\n                // 绘制行列\n\n                const tableCellList: HTMLDivElement[][] = []\n      for (let i = 0; i < 10; i++) {\n        const tr = document.createElement('tr')\n        tr.classList.add('table-row')\n        const trCellList: HTMLDivElement[] = []\n        for (let j = 0; j < 10; j++) {\n          const td = document.createElement('td')\n          td.classList.add('table-cel')\n          tr.append(td)\n          trCellList.push(td)\n        }\n        tablePanel.append(tr)\n        tableCellList.push(trCellList)\n      }\n\n      let colIndex = 0\n      let rowIndex = 0\n      // 移除所有格选择\n      function removeAllTableCellSelect() {\n        tableCellList.forEach(tr => {\n          tr.forEach(td => td.classList.remove('active'))\n        })\n      }\n      // 设置标题内容\n      function setTableTitle(payload: string) {\n        tableTitle.innerText = payload\n      }\n      // 恢复初始状态\n      function recoveryTable() {\n        // 还原选择样式、标题、选择行列\n        removeAllTableCellSelect()\n        setTableTitle('插入')\n        colIndex = 0\n        rowIndex = 0\n        // 隐藏panel\n        tablePanelContainer.style.display = 'none'\n      }\n      tableDom.onclick = function () {\n        console.log('table')\n        tablePanelContainer!.style.display = 'block'\n      }\n      tablePanel.onmousemove = function (evt) {\n        const celSize = 16\n        const rowMarginTop = 10\n        const celMarginRight = 6\n        const {\n          offsetX,\n          offsetY\n        } = evt\n        // 移除所有选择\n        removeAllTableCellSelect()\n        colIndex = Math.ceil(offsetX / (celSize + celMarginRight)) || 1\n        rowIndex = Math.ceil(offsetY / (celSize + rowMarginTop)) || 1\n        // 改变选择样式\n        tableCellList.forEach((tr, trIndex) => {\n          tr.forEach((td, tdIndex) => {\n            if (tdIndex < colIndex && trIndex < rowIndex) {\n              td.classList.add('active')\n            }\n          })\n        })\n        // 改变表格标题\n        setTableTitle(`${rowIndex}×${colIndex}`)\n      }\n      tableClose.onclick = function () {\n        recoveryTable()\n      }\n      tablePanel.onclick = function () {\n        // 应用选择\n        console.log(\"sds\")\n        instance.command.executeInsertTable(rowIndex, colIndex, [], '', '')\n        recoveryTable()\n      }\n\n      const imageDom = document.querySelector < HTMLDivElement > ('.menu-item__image') !\n        const imageFileDom = document.querySelector < HTMLInputElement > ('#image') !\n          imageDom.onclick = function () {\n            imageFileDom.click()\n          }\n      imageFileDom.onchange = function () {\n        const file = imageFileDom.files![0] !\n          const fileReader = new FileReader()\n        fileReader.readAsDataURL(file)\n        fileReader.onload = function () {\n          // 计算宽高\n          const image = new Image()\n          const value = fileReader.result as string\n          image.src = value\n          image.onload = function () {\n            instance.command.executeImage({\n              value,\n              width: image.width,\n              height: image.height\n            })\n            imageFileDom.value = ''\n          }\n        }\n      }\n\n      const hyperlinkDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__hyperlink'\n        ) !\n        hyperlinkDom.onclick = function () {\n          console.log('hyperlink')\n          new Dialog({\n            title: '超链接',\n            data: [{\n                type: 'text',\n                label: '文本',\n                name: 'name',\n                required: true,\n                placeholder: '请输入文本'\n              },\n              {\n                type: 'text',\n                label: '链接',\n                name: 'url',\n                required: true,\n                placeholder: '请输入链接'\n              }\n            ],\n            onConfirm: payload => {\n              let name1 = payload.find(p => p.name === 'name')\n              const name = !!name1 ? name1.value : null\n              if (!name) return\n              let url1 = payload.find(p => p.name === 'url')\n              const url = !!url1 ? url1.value : null\n              if (!url) return\n              instance.command.executeHyperlink({\n                type: ElementType.HYPERLINK,\n                value: '',\n                url,\n                valueList: name.split('').map(n => ({\n                  value: n,\n                  size: 16\n                }))\n              })\n            }\n          })\n        }\n\n      const separatorDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__separator'\n        ) !\n        const separatorOptionDom =\n          separatorDom.querySelector < HTMLDivElement > ('.options') !\n          separatorDom.onclick = function () {\n            console.log('separator')\n            separatorOptionDom.classList.toggle('visible')\n          }\n      separatorOptionDom.onmousedown = function (evt) {\n        let payload: number[] = []\n        const li = evt.target as HTMLLIElement\n        const separatorDash = li.dataset.separator ? li.dataset.separator.split(',').map(Number) : null\n        if (separatorDash) {\n          const isSingleLine = separatorDash.every(d => d === 0)\n          if (!isSingleLine) {\n            payload = separatorDash\n          }\n        }\n        instance.command.executeSeparator(payload)\n      }\n\n      const pageBreakDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__page-break'\n        ) !\n        pageBreakDom.onclick = function () {\n          console.log('pageBreak')\n          instance.command.executePageBreak()\n        }\n\n      const watermarkDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__watermark'\n        ) !\n        const watermarkOptionDom =\n          watermarkDom.querySelector < HTMLDivElement > ('.options') !\n          watermarkDom.onclick = function () {\n            console.log('watermark')\n            watermarkOptionDom.classList.toggle('visible')\n          }\n      watermarkOptionDom.onmousedown = function (evt) {\n        const li = evt.target as HTMLLIElement\n        const menu = li.dataset.menu!\n          watermarkOptionDom.classList.toggle('visible')\n        if (menu === 'add') {\n          new Dialog({\n            title: '水印',\n            data: [{\n                type: 'text',\n                label: '内容',\n                name: 'data',\n                required: true,\n                placeholder: '请输入内容'\n              },\n              {\n                type: 'color',\n                label: '颜色',\n                name: 'color',\n                required: true,\n                value: '#AEB5C0'\n              },\n              {\n                type: 'number',\n                label: '字体大小',\n                name: 'size',\n                required: true,\n                value: '120'\n              }\n            ],\n            onConfirm: payload => {\n              const nullableIndex = payload.findIndex(p => !p.value)\n              if (~nullableIndex) return\n              const watermark = payload.reduce((pre, cur) => {\n                pre[cur.name] = cur.value\n                return pre\n              }, < any > {})\n              instance.command.executeAddWatermark({\n                data: watermark.data,\n                color: watermark.color,\n                size: Number(watermark.size)\n              })\n            }\n          })\n        } else {\n          instance.command.executeDeleteWatermark()\n        }\n      }\n\n      const codeblockDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__codeblock'\n        ) !\n        codeblockDom.onclick = function () {\n          console.log('codeblock')\n          new Dialog({\n            title: '代码块',\n            data: [{\n              type: 'textarea',\n              name: 'codeblock',\n              placeholder: '请输入代码',\n              width: 500,\n              height: 300\n            }],\n            onConfirm: payload => {\n              let codeblock1 = payload.find(p => p.name === 'codeblock')\n              const codeblock = !!codeblock1 ? codeblock1.value : null\n              if (!codeblock) return\n              const tokenList = prism.tokenize(codeblock, prism.languages.javascript)\n              const formatTokenList = formatPrismToken(tokenList)\n              const elementList: IElement[] = []\n              for (let i = 0; i < formatTokenList.length; i++) {\n                const formatToken = formatTokenList[i]\n                const tokenStringList = formatToken.content.split('')\n                for (let j = 0; j < tokenStringList.length; j++) {\n                  const value = tokenStringList[j]\n                  const element: IElement = {\n                    value\n                  }\n                  if (formatToken.color) {\n                    element.color = formatToken.color\n                  }\n                  if (formatToken.bold) {\n                    element.bold = true\n                  }\n                  if (formatToken.italic) {\n                    element.italic = true\n                  }\n                  elementList.push(element)\n                }\n              }\n              elementList.unshift({\n                value: '\\n'\n              })\n              instance.command.executeInsertElementList(elementList)\n            }\n          })\n        }\n\n      const controlDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__control'\n        ) !\n        const controlOptionDom = controlDom.querySelector < HTMLDivElement > ('.options') !\n          controlDom.onclick = function () {\n            console.log('control')\n            controlOptionDom.classList.toggle('visible')\n          }\n      controlOptionDom.onmousedown = function (evt) {\n        controlOptionDom.classList.toggle('visible')\n        const li = evt.target as HTMLLIElement\n        const type = < ControlType > li.dataset.control\n        switch (type) {\n          case ControlType.TEXT:\n            new Dialog({\n              title: '文本控件',\n              data: [{\n                  type: 'text',\n                  label: '绑定字段',\n                  name: 'zd',\n                  required: true,\n                  placeholder: '请输入绑定字段'\n                },\n                {\n                  type: 'text',\n                  label: '字段名称',\n                  name: 'zdMc',\n                  required: true,\n                  placeholder: '请输入字段名称'\n                },\n                {\n                  type: 'text',\n                  label: '占位符',\n                  name: 'placeholder',\n                  required: true,\n                  placeholder: '请输入占位符'\n                },\n                {\n                  type: 'text',\n                  label: '默认值',\n                  name: 'value',\n                  placeholder: '请输入默认值'\n                }\n              ],\n              onConfirm: payload => {\n                let placeholder1 = payload.find(\n                  p => p.name === 'placeholder'\n                )\n                const placeholder = !!placeholder1 ? placeholder1.value : null\n                if (!placeholder) return\n                let value1 = payload.find(p => p.name === 'value')\n                const value = !!value1 ? value1.value : ''\n                let labelName1 = payload.find(p => p.name === 'zdMc')\n                const labelName = !!labelName1 ? labelName1.value : ''\n                let labelZd1 = payload.find(p => p.name === 'zd')\n                const labelZd = !!labelZd1 ? labelZd1.value : ''\n                instance.command.executeInsertElementList([{\n                  type: ElementType.CONTROL,\n                  value: '',\n                  control: {\n                    type,\n                    value: value ? [{\n                      value\n                    }] : null,\n                    placeholder,\n                    labelName,\n                    labelZd\n                  }\n                }])\n              }\n            })\n            break\n          case ControlType.SELECT:\n            new Dialog({\n              title: '列举控件',\n              data: [{\n                  type: 'text',\n                  label: '绑定字段',\n                  name: 'zd',\n                  required: true,\n                  placeholder: '请输入绑定字段'\n                },\n                {\n                  type: 'text',\n                  label: '字段名称',\n                  name: 'zdMc',\n                  required: true,\n                  placeholder: '请输入字段名称'\n                },\n                {\n                  type: 'text',\n                  label: '占位符',\n                  name: 'placeholder',\n                  required: true,\n                  placeholder: '请输入占位符'\n                },\n                {\n                  type: 'text',\n                  label: '默认值',\n                  name: 'code',\n                  placeholder: '请输入默认值'\n                },\n                {\n                  type: 'textarea',\n                  label: '值集',\n                  name: 'valueSets',\n                  required: true,\n                  height: 100,\n                  placeholder: `请输入值集JSON，例：\\n[{\\n\"value\":\"有\",\\n\"code\":\"98175\"\\n}]`\n                }\n              ],\n              onConfirm: payload => {\n                // console.log(Vue.prototype)\n                // Vue.prototype.$message.warningAlert(\"提示\", '提示信息')\n                let placeholder1 = payload.find(\n                  p => p.name === 'placeholder'\n                )\n                const placeholder = !!placeholder1 ? placeholder1.value : ''\n                if (!placeholder) return\n                let valueSets1 = payload.find(p => p.name === 'valueSets')\n                const valueSets = !!valueSets1 ? valueSets1.value : ''\n                if (!valueSets) return\n                let code1 = payload.find(p => p.name === 'code')\n                const code = !!code1 ? code1.value : ''\n                let labelName1 = payload.find(p => p.name === 'zdMc')\n                const labelName = !!labelName1 ? labelName1.value : ''\n                let labelZd1 = payload.find(p => p.name === 'zd')\n                const labelZd = !!labelZd1 ? labelZd1.value : ''\n                instance.command.executeInsertElementList([{\n                  type: ElementType.CONTROL,\n                  value: '',\n                  control: {\n                    type,\n                    code,\n                    labelName,\n                    labelZd,\n                    value: null,\n                    placeholder,\n                    valueSets: JSON.parse(valueSets)\n                    // valueSets: JSON.parse(valueSets)\n\n                  }\n                }])\n              }\n            })\n            break\n          case ControlType.CHECKBOX:\n            new Dialog({\n              title: '复选框控件',\n              data: [{\n                  type: 'text',\n                  label: '默认值',\n                  name: 'code',\n                  placeholder: '请输入默认值，多个值以英文逗号分割'\n                },\n                {\n                  type: 'textarea',\n                  label: '值集',\n                  name: 'valueSets',\n                  required: true,\n                  height: 100,\n                  placeholder: `请输入值集JSON，例：\\n[{\\n\"value\":\"有\",\\n\"code\":\"98175\"\\n}]`\n                }\n              ],\n              onConfirm: payload => {\n                let valueSets1 = payload.find(p => p.name === 'valueSets')\n                const valueSets = !!valueSets1 ? valueSets1.value : ''\n                if (!valueSets) return\n                let code1 = payload.find(p => p.name === 'code')\n                const code = !!code1 ? code1.value : ''\n                instance.command.executeInsertElementList([{\n                  type: ElementType.CONTROL,\n                  value: '',\n                  control: {\n                    type,\n                    code,\n                    value: null,\n                    valueSets: JSON.parse(valueSets)\n                  }\n                }])\n              }\n            })\n            break\n          default:\n            break\n        }\n      }\n\n      const checkboxDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__checkbox'\n        ) !\n        checkboxDom.onclick = function () {\n          console.log('checkbox', instance.command.getHTML().main)\n          instance.command.executeInsertElementList([{\n            type: ElementType.CHECKBOX,\n            value: ''\n          }])\n        }\n\n      const latexDom = document.querySelector < HTMLDivElement > ('.menu-item__latex') !\n        latexDom.onclick = function () {\n          console.log('LaTeX')\n          new Dialog({\n            title: 'LaTeX',\n            data: [{\n              type: 'textarea',\n              height: 100,\n              name: 'value',\n              placeholder: '请输入LaTeX文本'\n            }],\n            onConfirm: payload => {\n              let value1 = payload.find(p => p.name === 'value')\n              const value = !!value1 ? value1.value : ''\n              if (!value) return\n              instance.command.executeInsertElementList([{\n                type: ElementType.LATEX,\n                value\n              }])\n            }\n          })\n        }\n\n      const dateDom = document.querySelector < HTMLDivElement > ('.menu-item__date') !\n        const dateDomOptionDom = dateDom.querySelector < HTMLDivElement > ('.options') !\n          dateDom.onclick = function () {\n            console.log('date')\n            dateDomOptionDom.classList.toggle('visible')\n            // 定位调整\n            const bodyRect = document.body.getBoundingClientRect()\n            const dateDomOptionRect = dateDomOptionDom.getBoundingClientRect()\n            if (dateDomOptionRect.left + dateDomOptionRect.width > bodyRect.width) {\n              dateDomOptionDom.style.right = '0px'\n              dateDomOptionDom.style.left = 'unset'\n            } else {\n              dateDomOptionDom.style.right = 'unset'\n              dateDomOptionDom.style.left = '0px'\n            }\n            // 当前日期\n            const date = new Date()\n            const year = date.getFullYear().toString()\n            const month = (date.getMonth() + 1).toString().padStart(2, '0')\n            const day = date.getDate().toString().padStart(2, '0')\n            const hour = date.getHours().toString().padStart(2, '0')\n            const minute = date.getMinutes().toString().padStart(2, '0')\n            const second = date.getSeconds().toString().padStart(2, '0')\n            const dateString = `${year}-${month}-${day}`\n            const dateTimeString = `${dateString} ${hour}:${minute}:${second}`\n            dateDomOptionDom.querySelector < HTMLLIElement > ('li:first-child') !.innerText =\n              dateString\n            dateDomOptionDom.querySelector < HTMLLIElement > ('li:last-child') !.innerText =\n              dateTimeString\n          }\n      dateDomOptionDom.onmousedown = function (evt) {\n        debugger\n        const li = evt.target as HTMLLIElement\n        const dateFormat = li.dataset.format!\n          dateDomOptionDom.classList.toggle('visible')\n        instance.command.executeInsertElementList([{\n          type: ElementType.DATE,\n          value: '',\n          dateFormat,\n          valueList: [{\n            value: li.innerText.trim()\n          }]\n        }])\n      }\n\n      const blockDom = document.querySelector < HTMLDivElement > ('.menu-item__block') !\n        blockDom.onclick = function () {\n          console.log('block')\n          new Dialog({\n            title: '内容块',\n            data: [{\n                type: 'select',\n                label: '类型',\n                name: 'type',\n                value: 'iframe',\n                required: true,\n                options: [{\n                    label: '网址',\n                    value: 'iframe'\n                  },\n                  {\n                    label: '视频',\n                    value: 'video'\n                  }\n                ]\n              },\n              {\n                type: 'number',\n                label: '宽度',\n                name: 'width',\n                placeholder: '请输入宽度（默认页面内宽度）'\n              },\n              {\n                type: 'number',\n                label: '高度',\n                name: 'height',\n                required: true,\n                placeholder: '请输入高度'\n              },\n              {\n                type: 'textarea',\n                label: '地址',\n                height: 100,\n                name: 'value',\n                required: true,\n                placeholder: '请输入地址'\n              }\n            ],\n            onConfirm: payload => {\n              let type1 = payload.find(p => p.name === 'type')\n              const type = !!type1 ? type1.value : ''\n              if (!type) return\n              let value1 = payload.find(p => p.name === 'value')\n              const value = !!value1 ? value1.value : ''\n              if (!value) return\n              let width1 = payload.find(p => p.name === 'width')\n              const width = !!width1 ? width1.value : ''\n              let height1 = payload.find(p => p.name === 'height')\n              const height = !!height1 ? height1.value : ''\n              if (!height) return\n              const block: IBlock = {\n                type: < BlockType > type\n              }\n              if (block.type === BlockType.IFRAME) {\n                block.iframeBlock = {\n                  src: value\n                }\n              } else if (block.type === BlockType.VIDEO) {\n                block.videoBlock = {\n                  src: value\n                }\n              }\n              const blockElement: IElement = {\n                type: ElementType.BLOCK,\n                value: '',\n                height: Number(height),\n                block\n              }\n              if (width) {\n                blockElement.width = Number(width)\n              }\n              instance.command.executeInsertElementList([blockElement])\n            }\n          })\n        }\n\n      // 5. | 搜索&替换 | 打印 |\n      const searchCollapseDom = document.querySelector < HTMLDivElement > (\n          '.menu-item__search__collapse'\n        ) !\n        const searchInputDom = document.querySelector < HTMLInputElement > (\n            '.menu-item__search__collapse__search input'\n          ) !\n          const replaceInputDom = document.querySelector < HTMLInputElement > (\n              '.menu-item__search__collapse__replace input'\n            ) !\n            const searchDom =\n              document.querySelector < HTMLDivElement > ('.menu-item__search') !\n              searchDom.title = `搜索与替换(${isApple ? '⌘' : 'Ctrl'}+F)`\n      const searchResultDom =\n        searchCollapseDom.querySelector < HTMLLabelElement > ('.search-result') !\n        function setSearchResult() {\n          const result = instance.command.getSearchNavigateInfo()\n          if (result) {\n            const {\n              index,\n              count\n            } = result\n            searchResultDom.innerText = `${index}/${count}`\n          } else {\n            searchResultDom.innerText = ''\n          }\n        }\n      searchDom.onclick = function () {\n        console.log('search')\n        searchCollapseDom.style.display = 'block'\n        const bodyRect = document.body.getBoundingClientRect()\n        const searchRect = searchDom.getBoundingClientRect()\n        const searchCollapseRect = searchCollapseDom.getBoundingClientRect()\n        if (searchRect.left + searchCollapseRect.width > bodyRect.width) {\n          searchCollapseDom.style.right = '0px'\n          searchCollapseDom.style.left = 'unset'\n        } else {\n          searchCollapseDom.style.right = 'unset'\n        }\n        searchInputDom.focus()\n      }\n      searchCollapseDom.querySelector < HTMLSpanElement > ('span') !.onclick =\n        function () {\n          searchCollapseDom.style.display = 'none'\n          searchInputDom.value = ''\n          replaceInputDom.value = ''\n          instance.command.executeSearch(null)\n          setSearchResult()\n        }\n      searchInputDom.oninput = function () {\n        instance.command.executeSearch(searchInputDom.value || null)\n        setSearchResult()\n      }\n      searchInputDom.onkeydown = function (evt) {\n        if (evt.key === 'Enter') {\n          instance.command.executeSearch(searchInputDom.value || null)\n          setSearchResult()\n        }\n      }\n      searchCollapseDom.querySelector < HTMLButtonElement > ('button') !.onclick =\n        function () {\n          const searchValue = searchInputDom.value\n          const replaceValue = replaceInputDom.value\n          if (searchValue && replaceValue && searchValue !== replaceValue) {\n            instance.command.executeReplace(replaceValue)\n          }\n        }\n      searchCollapseDom.querySelector < HTMLDivElement > ('.arrow-left') !.onclick =\n        function () {\n          instance.command.executeSearchNavigatePre()\n          setSearchResult()\n        }\n      searchCollapseDom.querySelector < HTMLDivElement > ('.arrow-right') !.onclick =\n        function () {\n          instance.command.executeSearchNavigateNext()\n          setSearchResult()\n        }\n\n      const printDom = document.querySelector < HTMLDivElement > ('.menu-item__print') !\n        printDom.title = `打印(${isApple ? '⌘' : 'Ctrl'}+P)`\n      printDom.onclick = function () {\n        console.log('print')\n        instance.command.executePrint()\n      }\n\n      // 6. 目录显隐 | 页面模式 | 纸张缩放 | 纸张大小 | 纸张方向 | 页边距 | 全屏\n      async function updateCatalog() {\n        const catalog = await instance.command.getCatalog()\n        const catalogMainDom =\n          document.querySelector < HTMLDivElement > ('.catalog__main') !\n          catalogMainDom.innerHTML = ''\n        if (catalog) {\n          const appendCatalog = (\n            parent: HTMLDivElement,\n            catalogItems: ICatalogItem[]\n          ) => {\n            for (let c = 0; c < catalogItems.length; c++) {\n              const catalogItem = catalogItems[c]\n              const catalogItemDom = document.createElement('div')\n              catalogItemDom.classList.add('catalog-item')\n              // 渲染\n              const catalogItemContentDom = document.createElement('div')\n              catalogItemContentDom.classList.add('catalog-item__content')\n              const catalogItemContentSpanDom = document.createElement('span')\n              catalogItemContentSpanDom.innerText = catalogItem.name\n              catalogItemContentDom.append(catalogItemContentSpanDom)\n              // 定位\n              catalogItemContentDom.onclick = () => {\n                instance.command.executeLocationCatalog(catalogItem.id)\n              }\n              catalogItemDom.append(catalogItemContentDom)\n              if (catalogItem.subCatalog && catalogItem.subCatalog.length) {\n                appendCatalog(catalogItemDom, catalogItem.subCatalog)\n              }\n              // 追加\n              parent.append(catalogItemDom)\n            }\n          }\n          appendCatalog(catalogMainDom, catalog)\n        }\n      }\n      let isCatalogShow = true\n      const catalogDom = document.querySelector < HTMLElement > ('.catalog') !\n        const catalogModeDom =\n          document.querySelector < HTMLDivElement > ('.catalog-mode') !\n          const catalogHeaderCloseDom = document.querySelector < HTMLDivElement > (\n              '.catalog__header__close'\n            ) !\n            const switchCatalog = () => {\n              isCatalogShow = !isCatalogShow\n              if (isCatalogShow) {\n                catalogDom.style.display = 'block'\n                updateCatalog()\n              } else {\n                catalogDom.style.display = 'none'\n              }\n            }\n      catalogModeDom.onclick = switchCatalog\n      // catalogHeaderCloseDom.onclick = switchCatalog\n\n      const pageModeDom = document.querySelector < HTMLDivElement > ('.page-mode') !\n        const pageModeOptionsDom =\n          pageModeDom.querySelector < HTMLDivElement > ('.options') !\n          pageModeDom.onclick = function () {\n            pageModeOptionsDom.classList.toggle('visible')\n          }\n      pageModeOptionsDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        instance.command.executePageMode( < PageMode > li.dataset.pageMode!)\n      }\n\n      document.querySelector < HTMLDivElement > ('.page-scale-percentage') !.onclick =\n        function () {\n          console.log('page-scale-recovery')\n          instance.command.executePageScaleRecovery()\n        }\n\n      document.querySelector < HTMLDivElement > ('.page-scale-minus') !.onclick =\n        function () {\n          console.log('page-scale-minus')\n          instance.command.executePageScaleMinus()\n        }\n\n      document.querySelector < HTMLDivElement > ('.page-scale-add') !.onclick =\n        function () {\n          console.log('page-scale-add')\n          instance.command.executePageScaleAdd()\n        }\n\n      // 纸张大小\n      const paperSizeDom = document.querySelector < HTMLDivElement > ('.paper-size') !\n        const paperSizeDomOptionsDom =\n          paperSizeDom.querySelector < HTMLDivElement > ('.options') !\n          paperSizeDom.onclick = function () {\n            paperSizeDomOptionsDom.classList.toggle('visible')\n          }\n      paperSizeDomOptionsDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        const paperType = li.dataset.paperSize!\n          const [width, height] = paperType.split('*').map(Number)\n        instance.command.executePaperSize(width, height)\n        // 纸张状态回显\n        paperSizeDomOptionsDom\n          .querySelectorAll('li')\n          .forEach(child => child.classList.remove('active'))\n        li.classList.add('active')\n      }\n\n      // 纸张方向\n      const paperDirectionDom =\n        document.querySelector < HTMLDivElement > ('.paper-direction') !\n        const paperDirectionDomOptionsDom =\n          paperDirectionDom.querySelector < HTMLDivElement > ('.options') !\n          paperDirectionDom.onclick = function () {\n            paperDirectionDomOptionsDom.classList.toggle('visible')\n          }\n      paperDirectionDomOptionsDom.onclick = function (evt) {\n        const li = evt.target as HTMLLIElement\n        const paperDirection = li.dataset.paperDirection!\n          instance.command.executePaperDirection( < PaperDirection > paperDirection)\n        // 纸张方向状态回显\n        paperDirectionDomOptionsDom\n          .querySelectorAll('li')\n          .forEach(child => child.classList.remove('active'))\n        li.classList.add('active')\n      }\n\n      // 页面边距\n      const paperMarginDom =\n        document.querySelector < HTMLDivElement > ('.paper-margin') !\n        paperMarginDom.onclick = function () {\n          const [topMargin, rightMargin, bottomMargin, leftMargin] =\n          instance.command.getPaperMargin()\n          new Dialog({\n            title: '页边距',\n            data: [{\n                type: 'text',\n                label: '上边距',\n                name: 'top',\n                required: true,\n                value: `${topMargin}`,\n                placeholder: '请输入上边距'\n              },\n              {\n                type: 'text',\n                label: '下边距',\n                name: 'bottom',\n                required: true,\n                value: `${bottomMargin}`,\n                placeholder: '请输入下边距'\n              },\n              {\n                type: 'text',\n                label: '左边距',\n                name: 'left',\n                required: true,\n                value: `${leftMargin}`,\n                placeholder: '请输入左边距'\n              },\n              {\n                type: 'text',\n                label: '右边距',\n                name: 'right',\n                required: true,\n                value: `${rightMargin}`,\n                placeholder: '请输入右边距'\n              }\n            ],\n            onConfirm: payload => {\n              let top1 = payload.find(p => p.name === 'top')\n              const top = !!top1 ? top1.value : null\n              if (!top) return\n              let bottom1 = payload.find(p => p.name === 'bottom')\n              const bottom = !!bottom1 ? bottom1.value : null\n              if (!bottom) return\n              let left1 = payload.find(p => p.name === 'left')\n              const left = !!left1 ? left1.value : null\n              if (!left) return\n              let right1 = payload.find(p => p.name === 'right')\n              const right = !!right1 ? right1.value : null\n              if (!right) return\n              instance.command.executeSetPaperMargin([\n                Number(top),\n                Number(right),\n                Number(bottom),\n                Number(left)\n              ])\n            }\n          })\n        }\n\n      // 全屏\n      const fullscreenDom = document.querySelector < HTMLDivElement > ('.fullscreen') !\n        fullscreenDom.onclick = toggleFullscreen\n      window.addEventListener('keydown', evt => {\n        if (evt.key === 'F11') {\n          toggleFullscreen()\n          evt.preventDefault()\n        }\n      })\n      document.addEventListener('fullscreenchange', () => {\n        fullscreenDom.classList.toggle('exist')\n      })\n\n      function toggleFullscreen() {\n        console.log('fullscreen')\n        if (!document.fullscreenElement) {\n          document.documentElement.requestFullscreen()\n        } else {\n          document.exitFullscreen()\n        }\n      }\n\n      // 7. 编辑器使用模式\n      let modeIndex = 0\n      const modeList = [{\n          mode: EditorMode.EDIT,\n          name: '编辑模式'\n        },\n        {\n          mode: EditorMode.CLEAN,\n          name: '清洁模式'\n        },\n        {\n          mode: EditorMode.READONLY,\n          name: '只读模式'\n        },\n        {\n          mode: EditorMode.FORM,\n          name: '表单模式'\n        },\n        {\n          mode: EditorMode.PRINT,\n          name: '打印模式'\n        }\n      ]\n      const modeElement = document.querySelector < HTMLDivElement > ('.editor-mode') !\n        modeElement.onclick = function () {\n          // 模式选择循环\n          modeIndex === modeList.length - 1 ? (modeIndex = 0) : modeIndex++\n          // 设置模式\n          const {\n            name,\n            mode\n          } = modeList[modeIndex]\n          modeElement.innerText = name\n          instance.command.executeMode(mode)\n          // 设置菜单栏权限视觉反馈\n          const isReadonly = mode === EditorMode.READONLY\n          const enableMenuList = ['search', 'print']\n          document.querySelectorAll < HTMLDivElement > ('.menu-item>div').forEach(dom => {\n            const menu = dom.dataset.menu\n            isReadonly && (!menu || !enableMenuList.includes(menu)) ?\n              dom.classList.add('disable') :\n              dom.classList.remove('disable')\n          })\n        }\n\n      // 模拟批注\n      const commentDom = document.querySelector < HTMLDivElement > ('.comment') !\n        async function updateComment() {\n          const groupIds = await instance.command.getGroupIds()\n          for (const comment of commentList) {\n            const activeCommentDom = commentDom.querySelector < HTMLDivElement > (\n              `.comment-item[data-id='${comment.id}']`\n            )\n            // 编辑器是否存在对应成组id\n            if (groupIds.includes(comment.id)) {\n              // 当前dom是否存在-不存在则追加\n              if (!activeCommentDom) {\n                const commentItem = document.createElement('div')\n                commentItem.classList.add('comment-item')\n                commentItem.setAttribute('data-id', comment.id)\n                commentItem.onclick = () => {\n                  instance.command.executeLocationGroup(comment.id)\n                }\n                commentDom.append(commentItem)\n                // 选区信息\n                const commentItemTitle = document.createElement('div')\n                commentItemTitle.classList.add('comment-item__title')\n                commentItemTitle.append(document.createElement('span'))\n                const commentItemTitleContent = document.createElement('span')\n                commentItemTitleContent.innerText = comment.rangeText\n                commentItemTitle.append(commentItemTitleContent)\n                const closeDom = document.createElement('i')\n                closeDom.onclick = () => {\n                  instance.command.executeDeleteGroup(comment.id)\n                }\n                commentItemTitle.append(closeDom)\n                commentItem.append(commentItemTitle)\n                // 基础信息\n                const commentItemInfo = document.createElement('div')\n                commentItemInfo.classList.add('comment-item__info')\n                const commentItemInfoName = document.createElement('span')\n                commentItemInfoName.innerText = comment.userName\n                const commentItemInfoDate = document.createElement('span')\n                commentItemInfoDate.innerText = comment.createdDate\n                commentItemInfo.append(commentItemInfoName)\n                commentItemInfo.append(commentItemInfoDate)\n                commentItem.append(commentItemInfo)\n                // 详细评论\n                const commentItemContent = document.createElement('div')\n                commentItemContent.classList.add('comment-item__content')\n                commentItemContent.innerText = comment.content\n                commentItem.append(commentItemContent)\n                commentDom.append(commentItem)\n              }\n            } else {\n              // 编辑器内不存在对应成组id则dom则移除\n              if (activeCommentDom) {\n                activeCommentDom.remove()\n              }\n            }\n          }\n        }\n      //   //  直接下载PDF\n      //   const canvasToPdf = document.querySelector<HTMLDivElement>('.canvas2pdf')!\n      //   canvasToPdf.onclick = function(){\n      //     // 获取Canvas元素\n      // var canvas = document.querySelector<HTMLDivElement>('#canvas canvas');\n\n      // // 创建一个新的jsPDF实例\n      // var pdf = new jsPDF();\n\n      // // 将Canvas转换为图像数据URL\n      // var canvasDataURL = canvas.toDataURL('image/jpeg', 1.0);\n\n      // // 将图像数据URL添加到PDF中\n      // pdf.addImage(canvasDataURL, 'JPEG', 0, 0, canvas.width, canvas.height);\n\n      // // 保存PDF文件\n      // pdf.save('canvas.pdf');\n      //   }\n      // 8. 内部事件监听\n      instance.listener.rangeStyleChange = function (payload) {\n        // 控件类型\n        payload.type === ElementType.SUBSCRIPT ?\n          subscriptDom.classList.add('active') :\n          subscriptDom.classList.remove('active')\n        payload.type === ElementType.SUPERSCRIPT ?\n          superscriptDom.classList.add('active') :\n          superscriptDom.classList.remove('active')\n        payload.type === ElementType.SEPARATOR ?\n          separatorDom.classList.add('active') :\n          separatorDom.classList.remove('active')\n        separatorOptionDom\n          .querySelectorAll('li')\n          .forEach(li => li.classList.remove('active'))\n        if (payload.type === ElementType.SEPARATOR) {\n          const separator = payload.dashArray.join(',') || '0,0'\n          const curSeparatorDom = separatorOptionDom.querySelector < HTMLLIElement > (\n              `[data-separator='${separator}']`\n            ) !\n            if (curSeparatorDom) {\n              curSeparatorDom.classList.add('active')\n            }\n        }\n\n        // 富文本\n        fontOptionDom\n          .querySelectorAll < HTMLLIElement > ('li')\n          .forEach(li => li.classList.remove('active'))\n        const curFontDom = fontOptionDom.querySelector < HTMLLIElement > (\n          `[data-family='${payload.font}']`\n        )\n        if (curFontDom) {\n          fontSelectDom.innerText = curFontDom.innerText\n          fontSelectDom.style.fontFamily = payload.font\n          curFontDom.classList.add('active')\n        }\n        sizeOptionDom\n          .querySelectorAll < HTMLLIElement > ('li')\n          .forEach(li => li.classList.remove('active'))\n        const curSizeDom = sizeOptionDom.querySelector < HTMLLIElement > (\n          `[data-size='${payload.size}']`\n        )\n        if (curSizeDom) {\n          sizeSelectDom.innerText = curSizeDom.innerText\n          curSizeDom.classList.add('active')\n        } else {\n          sizeSelectDom.innerText = `${payload.size}`\n        }\n        payload.bold ?\n          boldDom.classList.add('active') :\n          boldDom.classList.remove('active')\n        payload.italic ?\n          italicDom.classList.add('active') :\n          italicDom.classList.remove('active')\n        payload.underline ?\n          underlineDom.classList.add('active') :\n          underlineDom.classList.remove('active')\n        payload.strikeout ?\n          strikeoutDom.classList.add('active') :\n          strikeoutDom.classList.remove('active')\n        if (payload.color) {\n          colorDom.classList.add('active')\n          colorControlDom.value = payload.color\n          colorSpanDom.style.backgroundColor = payload.color\n        } else {\n          colorDom.classList.remove('active')\n          colorControlDom.value = '#000000'\n          colorSpanDom.style.backgroundColor = '#000000'\n        }\n        if (payload.highlight) {\n          highlightDom.classList.add('active')\n          highlightControlDom.value = payload.highlight\n          highlightSpanDom.style.backgroundColor = payload.highlight\n        } else {\n          highlightDom.classList.remove('active')\n          highlightControlDom.value = '#ffff00'\n          highlightSpanDom.style.backgroundColor = '#ffff00'\n        }\n\n        // 行布局\n        leftDom.classList.remove('active')\n        centerDom.classList.remove('active')\n        rightDom.classList.remove('active')\n        alignmentDom.classList.remove('active')\n        if (payload.rowFlex && payload.rowFlex === 'right') {\n          rightDom.classList.add('active')\n        } else if (payload.rowFlex && payload.rowFlex === 'center') {\n          centerDom.classList.add('active')\n        } else if (payload.rowFlex && payload.rowFlex === 'alignment') {\n          alignmentDom.classList.add('active')\n        } else {\n          leftDom.classList.add('active')\n        }\n\n        // 行间距\n        rowOptionDom\n          .querySelectorAll < HTMLLIElement > ('li')\n          .forEach(li => li.classList.remove('active'))\n        const curRowMarginDom = rowOptionDom.querySelector < HTMLLIElement > (\n            `[data-rowmargin='${payload.rowMargin}']`\n          ) !\n          curRowMarginDom.classList.add('active')\n\n        // 功能\n        payload.undo ?\n          undoDom.classList.remove('no-allow') :\n          undoDom.classList.add('no-allow')\n        payload.redo ?\n          redoDom.classList.remove('no-allow') :\n          redoDom.classList.add('no-allow')\n        payload.painter ?\n          painterDom.classList.add('active') :\n          painterDom.classList.remove('active')\n\n        // 标题\n        titleOptionDom\n          .querySelectorAll < HTMLLIElement > ('li')\n          .forEach(li => li.classList.remove('active'))\n        if (payload.level) {\n          const curTitleDom = titleOptionDom.querySelector < HTMLLIElement > (\n              `[data-level='${payload.level}']`\n            ) !\n            titleSelectDom.innerText = curTitleDom.innerText\n          curTitleDom.classList.add('active')\n        } else {\n          titleSelectDom.innerText = '正文'\n          titleOptionDom.querySelector('li:first-child') !.classList.add('active')\n        }\n\n        // 列表\n        listOptionDom\n          .querySelectorAll < HTMLLIElement > ('li')\n          .forEach(li => li.classList.remove('active'))\n        if (payload.listType) {\n          listDom.classList.add('active')\n          const listType = payload.listType\n          const listStyle =\n            payload.listType === ListType.OL ? ListStyle.DECIMAL : payload.listType\n          const curListDom = listOptionDom.querySelector < HTMLLIElement > (\n            `[data-list-type='${listType}'][data-list-style='${listStyle}']`\n          )\n          if (curListDom) {\n            curListDom.classList.add('active')\n          }\n        } else {\n          listDom.classList.remove('active')\n        }\n\n        // 批注\n        commentDom\n          .querySelectorAll < HTMLDivElement > ('.comment-item')\n          .forEach(commentItemDom => {\n            commentItemDom.classList.remove('active')\n          })\n        if (payload.groupIds) {\n          const [id] = payload.groupIds\n          const activeCommentDom = commentDom.querySelector < HTMLDivElement > (\n            `.comment-item[data-id='${id}']`\n          )\n          if (activeCommentDom) {\n            activeCommentDom.classList.add('active')\n            scrollIntoView(commentDom, activeCommentDom)\n          }\n        }\n      }\n\n      instance.listener.visiblePageNoListChange = function (payload) {\n        const text = payload.map(i => i + 1).join('、')\n        document.querySelector < HTMLSpanElement > ('.page-no-list') !.innerText = text\n      }\n\n      instance.listener.pageSizeChange = function (payload) {\n        document.querySelector < HTMLSpanElement > (\n          '.page-size'\n        ) !.innerText = `${payload}`\n      }\n\n      instance.listener.intersectionPageNoChange = function (payload) {\n        document.querySelector < HTMLSpanElement > ('.page-no') !.innerText = `${payload + 1\n      }`\n      }\n\n      instance.listener.pageScaleChange = function (payload) {\n        document.querySelector < HTMLSpanElement > (\n          '.page-scale-percentage'\n        ) !.innerText = `${Math.floor(payload * 10 * 10)}%`\n      }\n\n      instance.listener.controlChange = function (payload) {\n        const disableMenusInControlContext = [\n          'superscript',\n          'subscript',\n          'table',\n          'image',\n          'hyperlink',\n          'separator',\n          'codeblock',\n          'page-break',\n          'control',\n          'checkbox'\n        ]\n        // 菜单操作权限\n        disableMenusInControlContext.forEach(menu => {\n          const menuDom = document.querySelector < HTMLDivElement > (\n              `.menu-item__${menu}`\n            ) !\n            payload ?\n            menuDom.classList.add('disable') :\n            menuDom.classList.remove('disable')\n        })\n      }\n\n      instance.listener.pageModeChange = function (payload) {\n        const activeMode = pageModeOptionsDom.querySelector < HTMLLIElement > (\n            `[data-page-mode='${payload}']`\n          ) !\n          pageModeOptionsDom\n          .querySelectorAll('li')\n          .forEach(li => li.classList.remove('active'))\n        activeMode.classList.add('active')\n      }\n\n      const handleContentChange = async function () {\n        // 字数\n        const wordCount = await instance.command.getWordCount()\n        console.log(instance)\n        document.querySelector < HTMLSpanElement > ('.word-count') !.innerText = `${wordCount || 0\n      }`\n        // 目录\n        if (isCatalogShow) {\n          nextTick(() => {\n            updateCatalog()\n          })\n        }\n        // 批注\n        nextTick(() => {\n          updateComment()\n        })\n      }\n      instance.listener.contentChange = debounce(handleContentChange, 200)\n      handleContentChange()\n\n      instance.listener.saved = function (payload) {\n        console.log('elementList: ', payload)\n      }\n\n      // 9. 右键菜单注册\n      instance.register.contextMenuList([{\n          name: '批注',\n          when: payload => {\n            return (\n              !payload.isReadonly &&\n              payload.editorHasSelection &&\n              payload.zone === EditorZone.MAIN\n            )\n          },\n          callback: (command: Command) => {\n            new Dialog({\n              title: '批注',\n              data: [{\n                type: 'textarea',\n                label: '批注',\n                height: 100,\n                name: 'value',\n                required: true,\n                placeholder: '请输入批注'\n              }],\n              onConfirm: payload => {\n                let value1 = payload.find(p => p.name === 'value')\n\n                const value = !!value1 ? value1.value : ''\n                if (!value) return\n                const groupId = command.executeSetGroup()\n                if (!groupId) return\n                commentList.push({\n                  id: groupId,\n                  content: value,\n                  userName: 'Hufe',\n                  rangeText: command.getRangeText(),\n                  createdDate: new Date().toLocaleString()\n                })\n              }\n            })\n          }\n        },\n        {\n          name: '签名',\n          icon: 'signature',\n          when: payload => {\n            return !payload.isReadonly && payload.editorTextFocus\n          },\n          callback: (command: Command) => {\n            new Signature({\n              onConfirm(payload) {\n                if (!payload) return\n                const {\n                  value,\n                  width,\n                  height\n                } = payload\n                if (!value || !width || !height) return\n                command.executeInsertElementList([{\n                  value,\n                  width,\n                  height,\n                  type: ElementType.IMAGE\n                }])\n              }\n            })\n          }\n        },\n        {\n          name: '格式整理',\n          icon: 'word-tool',\n          when: payload => {\n            return !payload.isReadonly\n          },\n          callback: (command: Command) => {\n            command.executeWordTool()\n          }\n        }\n      ])\n\n      // 10. 快捷键注册\n      instance.register.shortcutList([{\n          key: KeyMap.P,\n          mod: true,\n          isGlobal: true,\n          callback: (command: Command) => {\n            command.executePrint()\n          }\n        },\n        {\n          key: KeyMap.F,\n          mod: true,\n          isGlobal: true,\n          callback: (command: Command) => {\n            const text = command.getRangeText()\n            searchDom.click()\n            if (text) {\n              searchInputDom.value = text\n              instance.command.executeSearch(text)\n              setSearchResult()\n            }\n          }\n        },\n        {\n          key: KeyMap.MINUS,\n          ctrl: true,\n          isGlobal: true,\n          callback: (command: Command) => {\n            command.executePageScaleMinus()\n          }\n        },\n        {\n          key: KeyMap.EQUAL,\n          ctrl: true,\n          isGlobal: true,\n          callback: (command: Command) => {\n            command.executePageScaleAdd()\n          }\n        },\n        {\n          key: KeyMap.ZERO,\n          ctrl: true,\n          isGlobal: true,\n          callback: (command: Command) => {\n            command.executePageScaleRecovery()\n          }\n        }\n      ])\n    },\n    methods: {\n      setHtml(val: any) {\n        console.log(val)\n        instanceExport.command.executeInsertElementList(val)\n      }\n    }\n  })\n</script>\n<style scoped>\n  .editbox {\n    width: 794px;\n    height: calc(100% - 80px);\n    display: flex;\n    position: relative;\n    margin: 0 auto;\n  }\n\n  .contentHtml {\n    width: 595px !important;\n    height: 842px !important;\n    background: #fff;\n  }\n\n  #printHtml {\n    width: 100%;\n    page-break-after: always;\n  }\n\n  .left-edit {\n    width: 595px;\n    height: 100%;\n    display: inline-block;\n  }\n\n  #canvas {\n    width: 100%;\n    height: 100%;\n    /* height: calc(100vh - 75px); */\n    overflow-y: auto;\n  }\n\n  .center-btn {\n    width: 500px;\n    display: inline-block;\n    height: 900px;\n    border: 1px solid #ededed;\n    background: #fff;\n  }\n\n  @media print {\n\n    @page {\n\n      size: 1108px 1600px;\n\n    }\n\n  }\n\n  .ownInput:empty::before {\n    content: attr(placeholder);\n  }\n\n  >>>.ownInput {\n    display: inline-block;\n    width: 150px;\n    height: 28px;\n  }\n\n  >>>tr {\n    page-break-inside: avoid;\n  }\n\n  .dio {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    z-index: 99;\n    opacity: 0;\n  }\n</style>\n<style scoped lang=\"scss\">\n  .menu {\n    width: 794px;\n    height: 90px;\n    display: block;\n    top: 148px;\n  }\n\n  .menu-item {\n    height: 42px;\n    padding-left: 20px;\n  }\n\n  .footer {\n    position: absolute;\n    left: 0;\n    width: 794px;\n  }\n\n  .editor>div {\n    margin: 95px auto;\n  }\n</style>\n<style>\n  .menu {\n    width: 808px;\n    height: 90px;\n    display: block;\n    top: 37px !important;\n    z-index: 99;\n  }\n\n  .menu-item {\n    height: 42px;\n    padding-left: 20px;\n  }\n\n  .footer {\n    position: absolute;\n    left: 0;\n    width: 808px;\n  }\n\n  .editor>div {\n    margin: 95px auto;\n  }\n</style>"]}]}